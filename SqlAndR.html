<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 9 章 SQLとR | OHDSIの本</title>
  <meta name="description" content="The Observational Health Data Sciences and Informatics (OHDSI) についての本。OHDSIのコミュニティ、オープンスタンダードとオープンソースソフトウェアについて詳述しています。" />
  <meta name="generator" content="bookdown 0.42 and GitBook 2.6.7" />

  <meta property="og:title" content="第 9 章 SQLとR | OHDSIの本" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://ohdsi.github.io/TheBookOfOhdsiInJapanese/images/Cover/Cover.png" />
  <meta property="og:description" content="The Observational Health Data Sciences and Informatics (OHDSI) についての本。OHDSIのコミュニティ、オープンスタンダードとオープンソースソフトウェアについて詳述しています。" />
  <meta name="github-repo" content="OHDSI/TheBookOfOhdsiInJapanese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 9 章 SQLとR | OHDSIの本" />
  
  <meta name="twitter:description" content="The Observational Health Data Sciences and Informatics (OHDSI) についての本。OHDSIのコミュニティ、オープンスタンダードとオープンソースソフトウェアについて詳述しています。" />
  <meta name="twitter:image" content="https://ohdsi.github.io/TheBookOfOhdsiInJapanese/images/Cover/Cover.png" />

<meta name="author" content="Observational Health Data Sciences and Informatics (OHDSI)" />


<meta name="date" content="2025-03-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="OhdsiAnalyticsTools.html"/>
<link rel="next" href="Cohorts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104086677-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104086677-2');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">OHDSIの本 </a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>序章</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#この本の目標"><i class="fa fa-check"></i>この本の目標</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書の構成"><i class="fa fa-check"></i>本書の構成</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#貢献者"><i class="fa fa-check"></i>貢献者</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ソフトウェアのバージョン"><i class="fa fa-check"></i>ソフトウェアのバージョン</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#ライセンス"><i class="fa fa-check"></i>ライセンス</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#本書が作成された方法"><i class="fa fa-check"></i>本書が作成された方法</a></li>
</ul></li>
<li class="part"><span><b>I OHDSI コミュニティ</b></span></li>
<li class="chapter" data-level="1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html"><i class="fa fa-check"></i><b>1</b> OHDSI コミュニティ</a>
<ul>
<li class="chapter" data-level="1.1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#データからエビデンスへの旅"><i class="fa fa-check"></i><b>1.1</b> データからエビデンスへの旅</a></li>
<li class="chapter" data-level="1.2" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#観察医療アウトカムパートナーシップomop"><i class="fa fa-check"></i><b>1.2</b> 観察医療アウトカムパートナーシップ（OMOP）</a></li>
<li class="chapter" data-level="1.3" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#オープンサイエンスの協働組織としてのohdsi"><i class="fa fa-check"></i><b>1.3</b> オープンサイエンスの協働組織としてのOHDSI</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#私たちの使命"><i class="fa fa-check"></i><b>1.3.1</b> 私たちの使命</a></li>
<li class="chapter" data-level="1.3.2" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#私たちのビジョン"><i class="fa fa-check"></i><b>1.3.2</b> 私たちのビジョン</a></li>
<li class="chapter" data-level="1.3.3" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#私たちの目標"><i class="fa fa-check"></i><b>1.3.3</b> 私たちの目標</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#ohdsiの進展"><i class="fa fa-check"></i><b>1.4</b> OHDSIの進展</a></li>
<li class="chapter" data-level="1.5" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#ohdsiにおける協力"><i class="fa fa-check"></i><b>1.5</b> OHDSIにおける協力</a></li>
<li class="chapter" data-level="1.6" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#まとめ"><i class="fa fa-check"></i><b>1.6</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="WhereToBegin.html"><a href="WhereToBegin.html"><i class="fa fa-check"></i><b>2</b> どこから始めようか</a>
<ul>
<li class="chapter" data-level="2.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#旅に参加しよう"><i class="fa fa-check"></i><b>2.1</b> 旅に参加しよう</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsiフォーラム"><i class="fa fa-check"></i><b>2.1.1</b> OHDSIフォーラム</a></li>
<li class="chapter" data-level="2.1.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsiイベント"><i class="fa fa-check"></i><b>2.1.2</b> OHDSIイベント</a></li>
<li class="chapter" data-level="2.1.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsiコミュニティコール"><i class="fa fa-check"></i><b>2.1.3</b> OHDSIコミュニティコール</a></li>
<li class="chapter" data-level="2.1.4" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsiワークグループ"><i class="fa fa-check"></i><b>2.1.4</b> OHDSIワークグループ</a></li>
<li class="chapter" data-level="2.1.5" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi地域支部"><i class="fa fa-check"></i><b>2.1.5</b> OHDSI地域支部</a></li>
<li class="chapter" data-level="2.1.6" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi研究ネットワーク"><i class="fa fa-check"></i><b>2.1.6</b> OHDSI研究ネットワーク</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#どこにフィットするか"><i class="fa fa-check"></i><b>2.2</b> どこにフィットするか</a></li>
<li class="chapter" data-level="2.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#まとめ-1"><i class="fa fa-check"></i><b>2.3</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="OpenScience.html"><a href="OpenScience.html"><i class="fa fa-check"></i><b>3</b> オープンサイエンス</a>
<ul>
<li class="chapter" data-level="3.1" data-path="OpenScience.html"><a href="OpenScience.html#オープンサイエンス"><i class="fa fa-check"></i><b>3.1</b> オープンサイエンス</a></li>
<li class="chapter" data-level="3.2" data-path="OpenScience.html"><a href="OpenScience.html#オープンサイエンスの実践-study-a-thon"><i class="fa fa-check"></i><b>3.2</b> オープンサイエンスの実践: Study-a-Thon</a></li>
<li class="chapter" data-level="3.3" data-path="OpenScience.html"><a href="OpenScience.html#オープンスタンダード"><i class="fa fa-check"></i><b>3.3</b> オープンスタンダード</a></li>
<li class="chapter" data-level="3.4" data-path="OpenScience.html"><a href="OpenScience.html#オープンソース"><i class="fa fa-check"></i><b>3.4</b> オープンソース</a></li>
<li class="chapter" data-level="3.5" data-path="OpenScience.html"><a href="OpenScience.html#オープンデータ"><i class="fa fa-check"></i><b>3.5</b> オープンデータ</a></li>
<li class="chapter" data-level="3.6" data-path="OpenScience.html"><a href="OpenScience.html#オープンな議論"><i class="fa fa-check"></i><b>3.6</b> オープンな議論</a></li>
<li class="chapter" data-level="3.7" data-path="OpenScience.html"><a href="OpenScience.html#ohdsiとfairガイディングプリンシプルズ"><i class="fa fa-check"></i><b>3.7</b> OHDSIとFAIRガイディングプリンシプルズ</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="OpenScience.html"><a href="OpenScience.html#序論"><i class="fa fa-check"></i><b>3.7.1</b> 序論</a></li>
<li class="chapter" data-level="3.7.2" data-path="OpenScience.html"><a href="OpenScience.html#検索可能性findability"><i class="fa fa-check"></i><b>3.7.2</b> 検索可能性（Findability）</a></li>
<li class="chapter" data-level="3.7.3" data-path="OpenScience.html"><a href="OpenScience.html#アクセシビリティaccessibility"><i class="fa fa-check"></i><b>3.7.3</b> アクセシビリティ（Accessibility）</a></li>
<li class="chapter" data-level="3.7.4" data-path="OpenScience.html"><a href="OpenScience.html#相互運用性interoperability"><i class="fa fa-check"></i><b>3.7.4</b> 相互運用性（Interoperability）</a></li>
<li class="chapter" data-level="3.7.5" data-path="OpenScience.html"><a href="OpenScience.html#再利用性reusability"><i class="fa fa-check"></i><b>3.7.5</b> 再利用性（Reusability）</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II 共通データモデル</b></span></li>
<li class="chapter" data-level="4" data-path="CommonDataModel.html"><a href="CommonDataModel.html"><i class="fa fa-check"></i><b>4</b> 共通データモデル</a>
<ul>
<li class="chapter" data-level="4.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#デザイン原則"><i class="fa fa-check"></i><b>4.1</b> デザイン原則</a></li>
<li class="chapter" data-level="4.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#データモデルの規約"><i class="fa fa-check"></i><b>4.2</b> データモデルの規約</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#model-Conv"><i class="fa fa-check"></i><b>4.2.1</b> モデルの一般的な規約</a></li>
<li class="chapter" data-level="4.2.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#スキーマの一般的な規約"><i class="fa fa-check"></i><b>4.2.2</b> スキーマの一般的な規約</a></li>
<li class="chapter" data-level="4.2.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#データテーブルの一般的な規約"><i class="fa fa-check"></i><b>4.2.3</b> データテーブルの一般的な規約</a></li>
<li class="chapter" data-level="4.2.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#domains"><i class="fa fa-check"></i><b>4.2.4</b> ドメインの一般的な規約</a></li>
<li class="chapter" data-level="4.2.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#コンテンツのコンセプトによる表現"><i class="fa fa-check"></i><b>4.2.5</b> コンテンツのコンセプトによる表現</a></li>
<li class="chapter" data-level="4.2.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#フィールドの一般的な命名規約"><i class="fa fa-check"></i><b>4.2.6</b> フィールドの一般的な命名規約</a></li>
<li class="chapter" data-level="4.2.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#concepts-Sources"><i class="fa fa-check"></i><b>4.2.7</b> コンセプトとソース値の違い</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#cdm標準化テーブル"><i class="fa fa-check"></i><b>4.3</b> CDM標準化テーブル</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#実際の例-子宮内膜症"><i class="fa fa-check"></i><b>4.3.1</b> 実際の例: 子宮内膜症</a></li>
<li class="chapter" data-level="4.3.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#person"><i class="fa fa-check"></i><b>4.3.2</b> PERSONテーブル</a></li>
<li class="chapter" data-level="4.3.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#observationPeriod"><i class="fa fa-check"></i><b>4.3.3</b> OBSERVATION_PERIODテーブル</a></li>
<li class="chapter" data-level="4.3.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#visitOccurrence"><i class="fa fa-check"></i><b>4.3.4</b> VISIT_OCCURRENCE</a></li>
<li class="chapter" data-level="4.3.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#conditionOccurrence"><i class="fa fa-check"></i><b>4.3.5</b> CONDITION_OCCURRENCE</a></li>
<li class="chapter" data-level="4.3.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#drugExposure"><i class="fa fa-check"></i><b>4.3.6</b> DRUG_EXPOSURE</a></li>
<li class="chapter" data-level="4.3.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#procedureOccurrence"><i class="fa fa-check"></i><b>4.3.7</b> PROCEDURE_OCCURRENCE</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#追加情報"><i class="fa fa-check"></i><b>4.4</b> 追加情報</a></li>
<li class="chapter" data-level="4.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#まとめ-2"><i class="fa fa-check"></i><b>4.5</b> まとめ</a></li>
<li class="chapter" data-level="4.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#演習"><i class="fa fa-check"></i><b>4.6</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html"><i class="fa fa-check"></i><b>5</b> 標準化ボキャブラリ</a>
<ul>
<li class="chapter" data-level="5.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#なぜボキャブラリが必要でなぜ標準化が必要なのか"><i class="fa fa-check"></i><b>5.1</b> なぜボキャブラリが必要で、なぜ標準化が必要なのか</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#標準化ボキャブラリの構築"><i class="fa fa-check"></i><b>5.1.1</b> 標準化ボキャブラリの構築</a></li>
<li class="chapter" data-level="5.1.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#accessVocabularies"><i class="fa fa-check"></i><b>5.1.2</b> 標準化ボキャブラリへのアクセス</a></li>
<li class="chapter" data-level="5.1.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#ボキャブラリの元-採用するか構築するか"><i class="fa fa-check"></i><b>5.1.3</b> ボキャブラリの元: 採用するか構築するか</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#コンセプト"><i class="fa fa-check"></i><b>5.2</b> コンセプト</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#コンセプトid"><i class="fa fa-check"></i><b>5.2.1</b> コンセプトID</a></li>
<li class="chapter" data-level="5.2.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#コンセプト名"><i class="fa fa-check"></i><b>5.2.2</b> コンセプト名</a></li>
<li class="chapter" data-level="5.2.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptDomains"><i class="fa fa-check"></i><b>5.2.3</b> ドメイン</a></li>
<li class="chapter" data-level="5.2.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#ボキャブラリ"><i class="fa fa-check"></i><b>5.2.4</b> ボキャブラリ</a></li>
<li class="chapter" data-level="5.2.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#コンセプトクラス"><i class="fa fa-check"></i><b>5.2.5</b> コンセプトクラス</a></li>
<li class="chapter" data-level="5.2.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#standardConcepts"><i class="fa fa-check"></i><b>5.2.6</b> 標準コンセプト</a></li>
<li class="chapter" data-level="5.2.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#非標準コンセプト"><i class="fa fa-check"></i><b>5.2.7</b> 非標準コンセプト</a></li>
<li class="chapter" data-level="5.2.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#分類コンセプト"><i class="fa fa-check"></i><b>5.2.8</b> 分類コンセプト</a></li>
<li class="chapter" data-level="5.2.9" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#コンセプトコード"><i class="fa fa-check"></i><b>5.2.9</b> コンセプトコード</a></li>
<li class="chapter" data-level="5.2.10" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptLifeCycle"><i class="fa fa-check"></i><b>5.2.10</b> ライフサイクル</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#関係"><i class="fa fa-check"></i><b>5.3</b> 関係</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptMapping"><i class="fa fa-check"></i><b>5.3.1</b> マッピング関係</a></li>
<li class="chapter" data-level="5.3.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#階層関係"><i class="fa fa-check"></i><b>5.3.2</b> 階層関係</a></li>
<li class="chapter" data-level="5.3.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#異なるボキャブラリーのコンセプト間の関係"><i class="fa fa-check"></i><b>5.3.3</b> 異なるボキャブラリーのコンセプト間の関係</a></li>
<li class="chapter" data-level="5.3.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#同一ボキャブラリーのコンセプト間の関係"><i class="fa fa-check"></i><b>5.3.4</b> 同一ボキャブラリーのコンセプト間の関係</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptAncestor"><i class="fa fa-check"></i><b>5.4</b> 階層</a></li>
<li class="chapter" data-level="5.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#内部参照テーブル"><i class="fa fa-check"></i><b>5.5</b> 内部参照テーブル</a></li>
<li class="chapter" data-level="5.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#specialSituations"><i class="fa fa-check"></i><b>5.6</b> 特別な状況</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#性別"><i class="fa fa-check"></i><b>5.6.1</b> 性別</a></li>
<li class="chapter" data-level="5.6.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#人種と民族"><i class="fa fa-check"></i><b>5.6.2</b> 人種と民族</a></li>
<li class="chapter" data-level="5.6.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#診断コーディング体系とomopコンディション"><i class="fa fa-check"></i><b>5.6.3</b> 診断コーディング体系とOMOPコンディション</a></li>
<li class="chapter" data-level="5.6.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#プロシージャーコーディング体系"><i class="fa fa-check"></i><b>5.6.4</b> プロシージャーコーディング体系</a></li>
<li class="chapter" data-level="5.6.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#デバイス"><i class="fa fa-check"></i><b>5.6.5</b> デバイス</a></li>
<li class="chapter" data-level="5.6.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#ビジットとサービス"><i class="fa fa-check"></i><b>5.6.6</b> ビジットとサービス</a></li>
<li class="chapter" data-level="5.6.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#医療従事者と専門分野"><i class="fa fa-check"></i><b>5.6.7</b> 医療従事者と専門分野</a></li>
<li class="chapter" data-level="5.6.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#特別な要件を持つ治療領域"><i class="fa fa-check"></i><b>5.6.8</b> 特別な要件を持つ治療領域</a></li>
<li class="chapter" data-level="5.6.9" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#rxNormExtension"><i class="fa fa-check"></i><b>5.6.9</b> 薬剤ドメインにおける標準コンセプト</a></li>
<li class="chapter" data-level="5.6.10" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#nullのバリエーション"><i class="fa fa-check"></i><b>5.6.10</b> NULLのバリエーション</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#まとめ-3"><i class="fa fa-check"></i><b>5.7</b> まとめ</a></li>
<li class="chapter" data-level="5.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#演習-1"><i class="fa fa-check"></i><b>5.8</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html"><i class="fa fa-check"></i><b>6</b> ETL（抽出-変換-読込）</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#はじめに"><i class="fa fa-check"></i><b>6.1</b> はじめに</a></li>
<li class="chapter" data-level="6.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#ステップ-1-etlのデザイン"><i class="fa fa-check"></i><b>6.2</b> ステップ 1: ETLのデザイン</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#white-rabbit"><i class="fa fa-check"></i><b>6.2.1</b> White Rabbit</a></li>
<li class="chapter" data-level="6.2.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#rabbit-in-a-hat"><i class="fa fa-check"></i><b>6.2.2</b> Rabbit-In-a-Hat</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#ステップ2-コードマッピングの作成"><i class="fa fa-check"></i><b>6.3</b> ステップ2: コードマッピングの作成</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#usagi"><i class="fa fa-check"></i><b>6.3.1</b> Usagi</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#ステップ-3-etlの実装"><i class="fa fa-check"></i><b>6.4</b> ステップ 3: ETLの実装</a></li>
<li class="chapter" data-level="6.5" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#ステップ-4-品質管理"><i class="fa fa-check"></i><b>6.5</b> ステップ 4: 品質管理</a></li>
<li class="chapter" data-level="6.6" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etlの規約とthemis"><i class="fa fa-check"></i><b>6.6</b> ETLの規約とTHEMIS</a></li>
<li class="chapter" data-level="6.7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#CDMandETLMaintenance"><i class="fa fa-check"></i><b>6.7</b> CDMおよびETLのメンテナンス</a></li>
<li class="chapter" data-level="6.8" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etlに関する最終的な考察"><i class="fa fa-check"></i><b>6.8</b> ETLに関する最終的な考察</a></li>
<li class="chapter" data-level="6.9" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#まとめ-4"><i class="fa fa-check"></i><b>6.9</b> まとめ</a></li>
<li class="chapter" data-level="6.10" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#演習-2"><i class="fa fa-check"></i><b>6.10</b> 演習</a></li>
</ul></li>
<li class="part"><span><b>III データ解析</b></span></li>
<li class="chapter" data-level="7" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html"><i class="fa fa-check"></i><b>7</b> データ解析の使用例</a>
<ul>
<li class="chapter" data-level="7.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#特性評価"><i class="fa fa-check"></i><b>7.1</b> 特性評価</a></li>
<li class="chapter" data-level="7.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#集団レベルの推定"><i class="fa fa-check"></i><b>7.2</b> 集団レベルの推定</a></li>
<li class="chapter" data-level="7.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#患者レベルの予測"><i class="fa fa-check"></i><b>7.3</b> 患者レベルの予測</a></li>
<li class="chapter" data-level="7.4" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#高血圧症における使用例"><i class="fa fa-check"></i><b>7.4</b> 高血圧症における使用例</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#特性評価に関する問い"><i class="fa fa-check"></i><b>7.4.1</b> 特性評価に関する問い</a></li>
<li class="chapter" data-level="7.4.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#集団レベルの推定問題"><i class="fa fa-check"></i><b>7.4.2</b> 集団レベルの推定問題</a></li>
<li class="chapter" data-level="7.4.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#患者レベルの予測問題"><i class="fa fa-check"></i><b>7.4.3</b> 患者レベルの予測問題</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#観察研究の限界"><i class="fa fa-check"></i><b>7.5</b> 観察研究の限界</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#誤ったデータ"><i class="fa fa-check"></i><b>7.5.1</b> 誤ったデータ</a></li>
<li class="chapter" data-level="7.5.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#欠損データ"><i class="fa fa-check"></i><b>7.5.2</b> 欠損データ</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#まとめ-5"><i class="fa fa-check"></i><b>7.6</b> まとめ</a></li>
<li class="chapter" data-level="7.7" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#演習-3"><i class="fa fa-check"></i><b>7.7</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html"><i class="fa fa-check"></i><b>8</b> OHDSI 分析ツール</a>
<ul>
<li class="chapter" data-level="8.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysisImplementation"><i class="fa fa-check"></i><b>8.1</b> 分析の実装</a></li>
<li class="chapter" data-level="8.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#分析戦略"><i class="fa fa-check"></i><b>8.2</b> 分析戦略</a></li>
<li class="chapter" data-level="8.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#atlas"><i class="fa fa-check"></i><b>8.3</b> ATLAS</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#セキュリティ"><i class="fa fa-check"></i><b>8.3.1</b> セキュリティ</a></li>
<li class="chapter" data-level="8.3.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#ドキュメント"><i class="fa fa-check"></i><b>8.3.2</b> ドキュメント</a></li>
<li class="chapter" data-level="8.3.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#インストール方法"><i class="fa fa-check"></i><b>8.3.3</b> インストール方法</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#methods-library"><i class="fa fa-check"></i><b>8.4</b> Methods Library</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#大規模分析サポート"><i class="fa fa-check"></i><b>8.4.1</b> 大規模分析サポート</a></li>
<li class="chapter" data-level="8.4.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#BigDataSupport"><i class="fa fa-check"></i><b>8.4.2</b> ビッグデータ対応</a></li>
<li class="chapter" data-level="8.4.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#ドキュメント-1"><i class="fa fa-check"></i><b>8.4.3</b> ドキュメント</a></li>
<li class="chapter" data-level="8.4.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#システム要件"><i class="fa fa-check"></i><b>8.4.4</b> システム要件</a></li>
<li class="chapter" data-level="8.4.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#installR"><i class="fa fa-check"></i><b>8.4.5</b> インストール方法</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#展開戦略"><i class="fa fa-check"></i><b>8.5</b> 展開戦略</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#broadsea"><i class="fa fa-check"></i><b>8.5.1</b> Broadsea</a></li>
<li class="chapter" data-level="8.5.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#amazon-aws"><i class="fa fa-check"></i><b>8.5.2</b> Amazon AWS</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#まとめ-6"><i class="fa fa-check"></i><b>8.6</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="SqlAndR.html"><a href="SqlAndR.html"><i class="fa fa-check"></i><b>9</b> SQLとR</a>
<ul>
<li class="chapter" data-level="9.1" data-path="SqlAndR.html"><a href="SqlAndR.html#SqlRender"><i class="fa fa-check"></i><b>9.1</b> SqlRender</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="SqlAndR.html"><a href="SqlAndR.html#sqlのパラメータ設定"><i class="fa fa-check"></i><b>9.1.1</b> SQLのパラメータ設定</a></li>
<li class="chapter" data-level="9.1.2" data-path="SqlAndR.html"><a href="SqlAndR.html#他のsql表現への置換"><i class="fa fa-check"></i><b>9.1.2</b> 他のSQL表現への置換</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="SqlAndR.html"><a href="SqlAndR.html#DatabaseConnector"><i class="fa fa-check"></i><b>9.2</b> DatabaseConnector</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="SqlAndR.html"><a href="SqlAndR.html#接続の作成"><i class="fa fa-check"></i><b>9.2.1</b> 接続の作成</a></li>
<li class="chapter" data-level="9.2.2" data-path="SqlAndR.html"><a href="SqlAndR.html#クエリの実行"><i class="fa fa-check"></i><b>9.2.2</b> クエリの実行</a></li>
<li class="chapter" data-level="9.2.3" data-path="SqlAndR.html"><a href="SqlAndR.html#ffdfオブジェクトを使用したクエリの実行"><i class="fa fa-check"></i><b>9.2.3</b> ffdfオブジェクトを使用したクエリの実行</a></li>
<li class="chapter" data-level="9.2.4" data-path="SqlAndR.html"><a href="SqlAndR.html#同じsqlを用いて異なるプラットフォームにクエリを実行する"><i class="fa fa-check"></i><b>9.2.4</b> 同じSQLを用いて異なるプラットフォームにクエリを実行する</a></li>
<li class="chapter" data-level="9.2.5" data-path="SqlAndR.html"><a href="SqlAndR.html#テーブルの挿入"><i class="fa fa-check"></i><b>9.2.5</b> テーブルの挿入</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="SqlAndR.html"><a href="SqlAndR.html#QueryTheCdm"><i class="fa fa-check"></i><b>9.3</b> CDMへのクエリ</a></li>
<li class="chapter" data-level="9.4" data-path="SqlAndR.html"><a href="SqlAndR.html#クエリ実行時にボキャブラリを使用する"><i class="fa fa-check"></i><b>9.4</b> クエリ実行時にボキャブラリを使用する</a></li>
<li class="chapter" data-level="9.5" data-path="SqlAndR.html"><a href="SqlAndR.html#querylibrary"><i class="fa fa-check"></i><b>9.5</b> QueryLibrary</a></li>
<li class="chapter" data-level="9.6" data-path="SqlAndR.html"><a href="SqlAndR.html#単純な研究デザイン"><i class="fa fa-check"></i><b>9.6</b> 単純な研究デザイン</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="SqlAndR.html"><a href="SqlAndR.html#問題の定義"><i class="fa fa-check"></i><b>9.6.1</b> 問題の定義</a></li>
<li class="chapter" data-level="9.6.2" data-path="SqlAndR.html"><a href="SqlAndR.html#曝露"><i class="fa fa-check"></i><b>9.6.2</b> 曝露</a></li>
<li class="chapter" data-level="9.6.3" data-path="SqlAndR.html"><a href="SqlAndR.html#アウトカム"><i class="fa fa-check"></i><b>9.6.3</b> アウトカム</a></li>
<li class="chapter" data-level="9.6.4" data-path="SqlAndR.html"><a href="SqlAndR.html#リスク期間"><i class="fa fa-check"></i><b>9.6.4</b> リスク期間</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="SqlAndR.html"><a href="SqlAndR.html#sqlとrを使用した研究の実施"><i class="fa fa-check"></i><b>9.7</b> SQLとRを使用した研究の実施</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="SqlAndR.html"><a href="SqlAndR.html#曝露コホート"><i class="fa fa-check"></i><b>9.7.1</b> 曝露コホート</a></li>
<li class="chapter" data-level="9.7.2" data-path="SqlAndR.html"><a href="SqlAndR.html#アウトカムコホート"><i class="fa fa-check"></i><b>9.7.2</b> アウトカムコホート</a></li>
<li class="chapter" data-level="9.7.3" data-path="SqlAndR.html"><a href="SqlAndR.html#発生率の計算"><i class="fa fa-check"></i><b>9.7.3</b> 発生率の計算</a></li>
<li class="chapter" data-level="9.7.4" data-path="SqlAndR.html"><a href="SqlAndR.html#クリーンアップ"><i class="fa fa-check"></i><b>9.7.4</b> クリーンアップ</a></li>
<li class="chapter" data-level="9.7.5" data-path="SqlAndR.html"><a href="SqlAndR.html#互換性"><i class="fa fa-check"></i><b>9.7.5</b> 互換性</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="SqlAndR.html"><a href="SqlAndR.html#まとめ-7"><i class="fa fa-check"></i><b>9.8</b> まとめ</a></li>
<li class="chapter" data-level="9.9" data-path="SqlAndR.html"><a href="SqlAndR.html#演習-4"><i class="fa fa-check"></i><b>9.9</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Cohorts.html"><a href="Cohorts.html"><i class="fa fa-check"></i><b>10</b> コホートの定義</a>
<ul>
<li class="chapter" data-level="10.1" data-path="Cohorts.html"><a href="Cohorts.html#コホートとは"><i class="fa fa-check"></i><b>10.1</b> コホートとは？</a></li>
<li class="chapter" data-level="10.2" data-path="Cohorts.html"><a href="Cohorts.html#ルールベースのコホート定義"><i class="fa fa-check"></i><b>10.2</b> ルールベースのコホート定義</a></li>
<li class="chapter" data-level="10.3" data-path="Cohorts.html"><a href="Cohorts.html#conceptSets"><i class="fa fa-check"></i><b>10.3</b> コンセプトセット</a></li>
<li class="chapter" data-level="10.4" data-path="Cohorts.html"><a href="Cohorts.html#確率的コホート定義"><i class="fa fa-check"></i><b>10.4</b> 確率的コホート定義</a></li>
<li class="chapter" data-level="10.5" data-path="Cohorts.html"><a href="Cohorts.html#コホート定義の妥当性"><i class="fa fa-check"></i><b>10.5</b> コホート定義の妥当性</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="Cohorts.html"><a href="Cohorts.html#ohdsi-ゴールドスタンダードフェノタイプライブラリ"><i class="fa fa-check"></i><b>10.5.1</b> OHDSI ゴールドスタンダードフェノタイプライブラリ</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="Cohorts.html"><a href="Cohorts.html#高血圧のコホート定義"><i class="fa fa-check"></i><b>10.6</b> 高血圧のコホート定義</a></li>
<li class="chapter" data-level="10.7" data-path="Cohorts.html"><a href="Cohorts.html#atlasを用いたコホートの実装"><i class="fa fa-check"></i><b>10.7</b> ATLASを用いたコホートの実装</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="Cohorts.html"><a href="Cohorts.html#初期イベント基準"><i class="fa fa-check"></i><b>10.7.1</b> 初期イベント基準</a></li>
<li class="chapter" data-level="10.7.2" data-path="Cohorts.html"><a href="Cohorts.html#コンセプトセットの定義"><i class="fa fa-check"></i><b>10.7.2</b> コンセプトセットの定義</a></li>
<li class="chapter" data-level="10.7.3" data-path="Cohorts.html"><a href="Cohorts.html#初期イベントの追加基準"><i class="fa fa-check"></i><b>10.7.3</b> 初期イベントの追加基準</a></li>
<li class="chapter" data-level="10.7.4" data-path="Cohorts.html"><a href="Cohorts.html#適格基準"><i class="fa fa-check"></i><b>10.7.4</b> 適格基準</a></li>
<li class="chapter" data-level="10.7.5" data-path="Cohorts.html"><a href="Cohorts.html#コホート離脱基準"><i class="fa fa-check"></i><b>10.7.5</b> コホート離脱基準</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="Cohorts.html"><a href="Cohorts.html#sqlを使用したコホートの実装"><i class="fa fa-check"></i><b>10.8</b> SQLを使用したコホートの実装</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="Cohorts.html"><a href="Cohorts.html#データベースへの接続-1"><i class="fa fa-check"></i><b>10.8.1</b> データベースへの接続</a></li>
<li class="chapter" data-level="10.8.2" data-path="Cohorts.html"><a href="Cohorts.html#コンセプトの指定"><i class="fa fa-check"></i><b>10.8.2</b> コンセプトの指定</a></li>
<li class="chapter" data-level="10.8.3" data-path="Cohorts.html"><a href="Cohorts.html#初回使用の発見"><i class="fa fa-check"></i><b>10.8.3</b> 初回使用の発見</a></li>
<li class="chapter" data-level="10.8.4" data-path="Cohorts.html"><a href="Cohorts.html#日の事前観察が必要"><i class="fa fa-check"></i><b>10.8.4</b> 365日の事前観察が必要</a></li>
<li class="chapter" data-level="10.8.5" data-path="Cohorts.html"><a href="Cohorts.html#高血圧の前診断が必要"><i class="fa fa-check"></i><b>10.8.5</b> 高血圧の前診断が必要</a></li>
<li class="chapter" data-level="10.8.6" data-path="Cohorts.html"><a href="Cohorts.html#過去に治療がないことが必要"><i class="fa fa-check"></i><b>10.8.6</b> 過去に治療がないことが必要</a></li>
<li class="chapter" data-level="10.8.7" data-path="Cohorts.html"><a href="Cohorts.html#単剤療法"><i class="fa fa-check"></i><b>10.8.7</b> 単剤療法</a></li>
<li class="chapter" data-level="10.8.8" data-path="Cohorts.html"><a href="Cohorts.html#コホート離脱"><i class="fa fa-check"></i><b>10.8.8</b> コホート離脱</a></li>
<li class="chapter" data-level="10.8.9" data-path="Cohorts.html"><a href="Cohorts.html#クリーンアップ-1"><i class="fa fa-check"></i><b>10.8.9</b> クリーンアップ</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="Cohorts.html"><a href="Cohorts.html#要約"><i class="fa fa-check"></i><b>10.9</b> 要約</a></li>
<li class="chapter" data-level="10.10" data-path="Cohorts.html"><a href="Cohorts.html#演習-5"><i class="fa fa-check"></i><b>10.10</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Characterization.html"><a href="Characterization.html"><i class="fa fa-check"></i><b>11</b> 特性評価</a>
<ul>
<li class="chapter" data-level="11.1" data-path="Characterization.html"><a href="Characterization.html#データベースレベルの特性評価"><i class="fa fa-check"></i><b>11.1</b> データベースレベルの特性評価</a></li>
<li class="chapter" data-level="11.2" data-path="Characterization.html"><a href="Characterization.html#コホート特性評価"><i class="fa fa-check"></i><b>11.2</b> コホート特性評価</a></li>
<li class="chapter" data-level="11.3" data-path="Characterization.html"><a href="Characterization.html#治療経路"><i class="fa fa-check"></i><b>11.3</b> 治療経路</a></li>
<li class="chapter" data-level="11.4" data-path="Characterization.html"><a href="Characterization.html#発生率"><i class="fa fa-check"></i><b>11.4</b> 発生率</a></li>
<li class="chapter" data-level="11.5" data-path="Characterization.html"><a href="Characterization.html#高血圧症患者の特性評価"><i class="fa fa-check"></i><b>11.5</b> 高血圧症患者の特性評価</a></li>
<li class="chapter" data-level="11.6" data-path="Characterization.html"><a href="Characterization.html#atlasにおけるデータベースの特性評価"><i class="fa fa-check"></i><b>11.6</b> ATLASにおけるデータベースの特性評価</a></li>
<li class="chapter" data-level="11.7" data-path="Characterization.html"><a href="Characterization.html#atlasにおけるコホート特性分析"><i class="fa fa-check"></i><b>11.7</b> ATLASにおけるコホート特性分析</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="Characterization.html"><a href="Characterization.html#デザイン"><i class="fa fa-check"></i><b>11.7.1</b> デザイン</a></li>
<li class="chapter" data-level="11.7.2" data-path="Characterization.html"><a href="Characterization.html#実行"><i class="fa fa-check"></i><b>11.7.2</b> 実行</a></li>
<li class="chapter" data-level="11.7.3" data-path="Characterization.html"><a href="Characterization.html#結果"><i class="fa fa-check"></i><b>11.7.3</b> 結果</a></li>
<li class="chapter" data-level="11.7.4" data-path="Characterization.html"><a href="Characterization.html#カスタム特徴量の定義"><i class="fa fa-check"></i><b>11.7.4</b> カスタム特徴量の定義</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="Characterization.html"><a href="Characterization.html#rでのコホートの特性評価"><i class="fa fa-check"></i><b>11.8</b> Rでのコホートの特性評価</a>
<ul>
<li class="chapter" data-level="11.8.1" data-path="Characterization.html"><a href="Characterization.html#コホートのインスタンス化"><i class="fa fa-check"></i><b>11.8.1</b> コホートのインスタンス化</a></li>
<li class="chapter" data-level="11.8.2" data-path="Characterization.html"><a href="Characterization.html#データ抽出"><i class="fa fa-check"></i><b>11.8.2</b> データ抽出</a></li>
<li class="chapter" data-level="11.8.3" data-path="Characterization.html"><a href="Characterization.html#事前に指定された分析の使用"><i class="fa fa-check"></i><b>11.8.3</b> 事前に指定された分析の使用</a></li>
<li class="chapter" data-level="11.8.4" data-path="Characterization.html"><a href="Characterization.html#集約共変量の作成"><i class="fa fa-check"></i><b>11.8.4</b> 集約共変量の作成</a></li>
<li class="chapter" data-level="11.8.5" data-path="Characterization.html"><a href="Characterization.html#出力形式"><i class="fa fa-check"></i><b>11.8.5</b> 出力形式</a></li>
<li class="chapter" data-level="11.8.6" data-path="Characterization.html"><a href="Characterization.html#カスタム共変量"><i class="fa fa-check"></i><b>11.8.6</b> カスタム共変量</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="Characterization.html"><a href="Characterization.html#atlasにおけるコホート経路分析"><i class="fa fa-check"></i><b>11.9</b> ATLASにおけるコホート経路分析</a>
<ul>
<li class="chapter" data-level="11.9.1" data-path="Characterization.html"><a href="Characterization.html#デザイン-1"><i class="fa fa-check"></i><b>11.9.1</b> デザイン</a></li>
<li class="chapter" data-level="11.9.2" data-path="Characterization.html"><a href="Characterization.html#実行-1"><i class="fa fa-check"></i><b>11.9.2</b> 実行</a></li>
<li class="chapter" data-level="11.9.3" data-path="Characterization.html"><a href="Characterization.html#結果の表示"><i class="fa fa-check"></i><b>11.9.3</b> 結果の表示</a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="Characterization.html"><a href="Characterization.html#atlas-における発生率分析"><i class="fa fa-check"></i><b>11.10</b> ATLAS における発生率分析</a>
<ul>
<li class="chapter" data-level="11.10.1" data-path="Characterization.html"><a href="Characterization.html#デザイン-2"><i class="fa fa-check"></i><b>11.10.1</b> デザイン</a></li>
<li class="chapter" data-level="11.10.2" data-path="Characterization.html"><a href="Characterization.html#実行-2"><i class="fa fa-check"></i><b>11.10.2</b> 実行</a></li>
<li class="chapter" data-level="11.10.3" data-path="Characterization.html"><a href="Characterization.html#結果の表示-1"><i class="fa fa-check"></i><b>11.10.3</b> 結果の表示</a></li>
</ul></li>
<li class="chapter" data-level="11.11" data-path="Characterization.html"><a href="Characterization.html#まとめ-8"><i class="fa fa-check"></i><b>11.11</b> まとめ</a></li>
<li class="chapter" data-level="11.12" data-path="Characterization.html"><a href="Characterization.html#演習-6"><i class="fa fa-check"></i><b>11.12</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html"><i class="fa fa-check"></i><b>12</b> 集団レベルの推定</a>
<ul>
<li class="chapter" data-level="12.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#CohortMethod"><i class="fa fa-check"></i><b>12.1</b> コホートメソッドの設計</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#傾向スコア"><i class="fa fa-check"></i><b>12.1.1</b> 傾向スコア</a></li>
<li class="chapter" data-level="12.1.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#VariableSelection"><i class="fa fa-check"></i><b>12.1.2</b> 変数選択</a></li>
<li class="chapter" data-level="12.1.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#キャリパー"><i class="fa fa-check"></i><b>12.1.3</b> キャリパー</a></li>
<li class="chapter" data-level="12.1.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#オーバーラップ選好スコア"><i class="fa fa-check"></i><b>12.1.4</b> オーバーラップ：選好スコア</a></li>
<li class="chapter" data-level="12.1.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#バランス"><i class="fa fa-check"></i><b>12.1.5</b> バランス</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#自己対照コホートデザイン"><i class="fa fa-check"></i><b>12.2</b> 自己対照コホートデザイン</a></li>
<li class="chapter" data-level="12.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#症例対照デザイン"><i class="fa fa-check"></i><b>12.3</b> 症例対照デザイン</a></li>
<li class="chapter" data-level="12.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ケースクロスオーバーデザイン"><i class="fa fa-check"></i><b>12.4</b> ケース・クロスオーバーデザイン</a></li>
<li class="chapter" data-level="12.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#自己対照症例シリーズデザイン"><i class="fa fa-check"></i><b>12.5</b> 自己対照症例シリーズデザイン</a></li>
<li class="chapter" data-level="12.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#高血圧症研究のデザイン"><i class="fa fa-check"></i><b>12.6</b> 高血圧症研究のデザイン</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#問題の定義-1"><i class="fa fa-check"></i><b>12.6.1</b> 問題の定義</a></li>
<li class="chapter" data-level="12.6.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#対象および比較対照"><i class="fa fa-check"></i><b>12.6.2</b> 対象および比較対照</a></li>
<li class="chapter" data-level="12.6.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#アウトカム-1"><i class="fa fa-check"></i><b>12.6.3</b> アウトカム</a></li>
<li class="chapter" data-level="12.6.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#リスク時間"><i class="fa fa-check"></i><b>12.6.4</b> リスク時間</a></li>
<li class="chapter" data-level="12.6.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#モデル"><i class="fa fa-check"></i><b>12.6.5</b> モデル</a></li>
<li class="chapter" data-level="12.6.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#研究要約"><i class="fa fa-check"></i><b>12.6.6</b> 研究要約</a></li>
<li class="chapter" data-level="12.6.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#コントロールクエスチョン"><i class="fa fa-check"></i><b>12.6.7</b> コントロールクエスチョン</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#PleAtlas"><i class="fa fa-check"></i><b>12.7</b> ATLASを使用した研究の実施</a>
<ul>
<li class="chapter" data-level="12.7.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ComparisonSettings"><i class="fa fa-check"></i><b>12.7.1</b> 比較コホート設定</a></li>
<li class="chapter" data-level="12.7.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#効果推定の分析設定"><i class="fa fa-check"></i><b>12.7.2</b> 効果推定の分析設定</a></li>
<li class="chapter" data-level="12.7.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#evaluationSettings"><i class="fa fa-check"></i><b>12.7.3</b> 評価の設定</a></li>
<li class="chapter" data-level="12.7.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#研究パッケージの実行"><i class="fa fa-check"></i><b>12.7.4</b> 研究パッケージの実行</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#pleR"><i class="fa fa-check"></i><b>12.8</b> Rを使用した研究の実施</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#コホートのインスタンス化-1"><i class="fa fa-check"></i><b>12.8.1</b> コホートのインスタンス化</a></li>
<li class="chapter" data-level="12.8.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#データ抽出-1"><i class="fa fa-check"></i><b>12.8.2</b> データ抽出</a></li>
<li class="chapter" data-level="12.8.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#研究集団の定義"><i class="fa fa-check"></i><b>12.8.3</b> 研究集団の定義</a></li>
<li class="chapter" data-level="12.8.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#傾向スコア-1"><i class="fa fa-check"></i><b>12.8.4</b> 傾向スコア</a></li>
<li class="chapter" data-level="12.8.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#アウトカムモデル"><i class="fa fa-check"></i><b>12.8.5</b> アウトカムモデル</a></li>
<li class="chapter" data-level="12.8.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#MultipleAnalyses"><i class="fa fa-check"></i><b>12.8.6</b> 複数の分析の実行</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#studyOutputs"><i class="fa fa-check"></i><b>12.9</b> 研究の結果</a>
<ul>
<li class="chapter" data-level="12.9.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#傾向スコアとモデル"><i class="fa fa-check"></i><b>12.9.1</b> 傾向スコアとモデル</a></li>
<li class="chapter" data-level="12.9.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#共変量のバランス"><i class="fa fa-check"></i><b>12.9.2</b> 共変量のバランス</a></li>
<li class="chapter" data-level="12.9.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#フォローアップとパワー"><i class="fa fa-check"></i><b>12.9.3</b> フォローアップとパワー</a></li>
<li class="chapter" data-level="12.9.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#カプランマイヤー"><i class="fa fa-check"></i><b>12.9.4</b> カプラン・マイヤー</a></li>
<li class="chapter" data-level="12.9.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#効果量の推定"><i class="fa fa-check"></i><b>12.9.5</b> 効果量の推定</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#まとめ-9"><i class="fa fa-check"></i><b>12.10</b> まとめ</a></li>
<li class="chapter" data-level="12.11" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#演習-7"><i class="fa fa-check"></i><b>12.11</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html"><i class="fa fa-check"></i><b>13</b> 患者レベルの予測</a>
<ul>
<li class="chapter" data-level="13.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#予測問題"><i class="fa fa-check"></i><b>13.1</b> 予測問題</a></li>
<li class="chapter" data-level="13.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#データ抽出-2"><i class="fa fa-check"></i><b>13.2</b> データ抽出</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#データ抽出の例"><i class="fa fa-check"></i><b>13.2.1</b> データ抽出の例</a></li>
<li class="chapter" data-level="13.2.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#負の値と欠損"><i class="fa fa-check"></i><b>13.2.2</b> 負の値と欠損</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#modelFitting"><i class="fa fa-check"></i><b>13.3</b> モデルの適合</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#正則化ロジスティック回帰"><i class="fa fa-check"></i><b>13.3.1</b> 正則化ロジスティック回帰</a></li>
<li class="chapter" data-level="13.3.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#勾配ブースティングマシン"><i class="fa fa-check"></i><b>13.3.2</b> 勾配ブースティングマシン</a></li>
<li class="chapter" data-level="13.3.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#ランダムフォレスト"><i class="fa fa-check"></i><b>13.3.3</b> ランダムフォレスト</a></li>
<li class="chapter" data-level="13.3.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#k-近傍法"><i class="fa fa-check"></i><b>13.3.4</b> K-近傍法</a></li>
<li class="chapter" data-level="13.3.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#ナイーブベイズ"><i class="fa fa-check"></i><b>13.3.5</b> ナイーブベイズ</a></li>
<li class="chapter" data-level="13.3.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#adaboost"><i class="fa fa-check"></i><b>13.3.6</b> AdaBoost</a></li>
<li class="chapter" data-level="13.3.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#決定木"><i class="fa fa-check"></i><b>13.3.7</b> 決定木</a></li>
<li class="chapter" data-level="13.3.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#多層パーセプトロン"><i class="fa fa-check"></i><b>13.3.8</b> 多層パーセプトロン</a></li>
<li class="chapter" data-level="13.3.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#深層学習"><i class="fa fa-check"></i><b>13.3.9</b> 深層学習</a></li>
<li class="chapter" data-level="13.3.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#その他のアルゴリズム"><i class="fa fa-check"></i><b>13.3.10</b> その他のアルゴリズム</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#予測モデルの評価"><i class="fa fa-check"></i><b>13.4</b> 予測モデルの評価</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#評価の種類"><i class="fa fa-check"></i><b>13.4.1</b> 評価の種類</a></li>
<li class="chapter" data-level="13.4.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#performance"><i class="fa fa-check"></i><b>13.4.2</b> 性能指標</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#患者レベル予測研究のデザイン"><i class="fa fa-check"></i><b>13.5</b> 患者レベル予測研究のデザイン</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#問題の定義-2"><i class="fa fa-check"></i><b>13.5.1</b> 問題の定義</a></li>
<li class="chapter" data-level="13.5.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#研究集団の定義-1"><i class="fa fa-check"></i><b>13.5.2</b> 研究集団の定義</a></li>
<li class="chapter" data-level="13.5.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#モデル開発の設定"><i class="fa fa-check"></i><b>13.5.3</b> モデル開発の設定</a></li>
<li class="chapter" data-level="13.5.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#モデル評価"><i class="fa fa-check"></i><b>13.5.4</b> モデル評価</a></li>
<li class="chapter" data-level="13.5.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#研究概要"><i class="fa fa-check"></i><b>13.5.5</b> 研究概要</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#atlasでの研究の実装"><i class="fa fa-check"></i><b>13.6</b> ATLASでの研究の実装</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#予測の問題設定"><i class="fa fa-check"></i><b>13.6.1</b> 予測の問題設定</a></li>
<li class="chapter" data-level="13.6.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#分析設定"><i class="fa fa-check"></i><b>13.6.2</b> 分析設定</a></li>
<li class="chapter" data-level="13.6.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#実行の設定"><i class="fa fa-check"></i><b>13.6.3</b> 実行の設定</a></li>
<li class="chapter" data-level="13.6.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#トレーニングの設定"><i class="fa fa-check"></i><b>13.6.4</b> トレーニングの設定</a></li>
<li class="chapter" data-level="13.6.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#研究のインポートとエクスポート"><i class="fa fa-check"></i><b>13.6.5</b> 研究のインポートとエクスポート</a></li>
<li class="chapter" data-level="13.6.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#研究パッケージのダウンロード"><i class="fa fa-check"></i><b>13.6.6</b> 研究パッケージのダウンロード</a></li>
<li class="chapter" data-level="13.6.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#研究の実行"><i class="fa fa-check"></i><b>13.6.7</b> 研究の実行</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#rでの研究実施"><i class="fa fa-check"></i><b>13.7</b> Rでの研究実施</a>
<ul>
<li class="chapter" data-level="13.7.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#コホートのインスタンス化-2"><i class="fa fa-check"></i><b>13.7.1</b> コホートのインスタンス化</a></li>
<li class="chapter" data-level="13.7.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#データ抽出-3"><i class="fa fa-check"></i><b>13.7.2</b> データ抽出</a></li>
<li class="chapter" data-level="13.7.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#追加の適格基準"><i class="fa fa-check"></i><b>13.7.3</b> 追加の適格基準</a></li>
<li class="chapter" data-level="13.7.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#モデル開発"><i class="fa fa-check"></i><b>13.7.4</b> モデル開発</a></li>
<li class="chapter" data-level="13.7.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#内部バリデーション"><i class="fa fa-check"></i><b>13.7.5</b> 内部バリデーション</a></li>
<li class="chapter" data-level="13.7.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#外部バリデーション"><i class="fa fa-check"></i><b>13.7.6</b> 外部バリデーション</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#結果の公表"><i class="fa fa-check"></i><b>13.8</b> 結果の公表</a>
<ul>
<li class="chapter" data-level="13.8.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#モデル性能"><i class="fa fa-check"></i><b>13.8.1</b> モデル性能</a></li>
<li class="chapter" data-level="13.8.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#モデルの比較"><i class="fa fa-check"></i><b>13.8.2</b> モデルの比較</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#患者レベルの予測に関する追加の機能"><i class="fa fa-check"></i><b>13.9</b> 患者レベルの予測に関する追加の機能</a>
<ul>
<li class="chapter" data-level="13.9.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#学術誌論文の生成"><i class="fa fa-check"></i><b>13.9.1</b> 学術誌論文の生成</a></li>
</ul></li>
<li class="chapter" data-level="13.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#まとめ-10"><i class="fa fa-check"></i><b>13.10</b> まとめ</a></li>
<li class="chapter" data-level="13.11" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#演習-8"><i class="fa fa-check"></i><b>13.11</b> 演習</a></li>
</ul></li>
<li class="part"><span><b>IV エビデンスの質</b></span></li>
<li class="chapter" data-level="14" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html"><i class="fa fa-check"></i><b>14</b> エビデンスの質</a>
<ul>
<li class="chapter" data-level="14.1" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#信頼できるエビデンスの属性"><i class="fa fa-check"></i><b>14.1</b> 信頼できるエビデンスの属性</a></li>
<li class="chapter" data-level="14.2" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#エビデンスの質の理解"><i class="fa fa-check"></i><b>14.2</b> エビデンスの質の理解</a></li>
<li class="chapter" data-level="14.3" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#エビデンスの質の伝達"><i class="fa fa-check"></i><b>14.3</b> エビデンスの質の伝達</a></li>
<li class="chapter" data-level="14.4" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#まとめ-11"><i class="fa fa-check"></i><b>14.4</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="DataQuality.html"><a href="DataQuality.html"><i class="fa fa-check"></i><b>15</b> データ品質</a>
<ul>
<li class="chapter" data-level="15.1" data-path="DataQuality.html"><a href="DataQuality.html#データ品質問題の原因"><i class="fa fa-check"></i><b>15.1</b> データ品質問題の原因</a></li>
<li class="chapter" data-level="15.2" data-path="DataQuality.html"><a href="DataQuality.html#一般的なデータ品質"><i class="fa fa-check"></i><b>15.2</b> 一般的なデータ品質</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="DataQuality.html"><a href="DataQuality.html#データ品質チェック"><i class="fa fa-check"></i><b>15.2.1</b> データ品質チェック</a></li>
<li class="chapter" data-level="15.2.2" data-path="DataQuality.html"><a href="DataQuality.html#etlUnitTests"><i class="fa fa-check"></i><b>15.2.2</b> ETL（抽出-変換-読込）単体テスト</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="DataQuality.html"><a href="DataQuality.html#研究特有のチェック"><i class="fa fa-check"></i><b>15.3</b> 研究特有のチェック</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="DataQuality.html"><a href="DataQuality.html#マッピングのチェック"><i class="fa fa-check"></i><b>15.3.1</b> マッピングのチェック</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="DataQuality.html"><a href="DataQuality.html#achillesInPractice"><i class="fa fa-check"></i><b>15.4</b> 実践におけるACHILLES</a></li>
<li class="chapter" data-level="15.5" data-path="DataQuality.html"><a href="DataQuality.html#dqdInPractice"><i class="fa fa-check"></i><b>15.5</b> Data Quality Dashboardの実践</a></li>
<li class="chapter" data-level="15.6" data-path="DataQuality.html"><a href="DataQuality.html#特定の研究チェックの実践"><i class="fa fa-check"></i><b>15.6</b> 特定の研究チェックの実践</a></li>
<li class="chapter" data-level="15.7" data-path="DataQuality.html"><a href="DataQuality.html#まとめ-12"><i class="fa fa-check"></i><b>15.7</b> まとめ</a></li>
<li class="chapter" data-level="15.8" data-path="DataQuality.html"><a href="DataQuality.html#演習-9"><i class="fa fa-check"></i><b>15.8</b> 演習</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html"><i class="fa fa-check"></i><b>16</b> 臨床的妥当性</a>
<ul>
<li class="chapter" data-level="16.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#CharacteristicsOfDatabase"><i class="fa fa-check"></i><b>16.1</b> 医療データベースの特性</a></li>
<li class="chapter" data-level="16.2" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#CohortValidation"><i class="fa fa-check"></i><b>16.2</b> コホート検証</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#コホート評価指標"><i class="fa fa-check"></i><b>16.2.1</b> コホート評価指標</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#ソースレコード検証"><i class="fa fa-check"></i><b>16.3</b> ソースレコード検証</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#ソースレコード検証の例"><i class="fa fa-check"></i><b>16.3.1</b> ソースレコード検証の例</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#phevaluator"><i class="fa fa-check"></i><b>16.4</b> PheValuator</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#phevaluatorによる検証例"><i class="fa fa-check"></i><b>16.4.1</b> PheValuatorによる検証例</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#GeneralizabilityOfEvidence"><i class="fa fa-check"></i><b>16.5</b> エビデンスの一般化可能性</a></li>
<li class="chapter" data-level="16.6" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#まとめ-13"><i class="fa fa-check"></i><b>16.6</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html"><i class="fa fa-check"></i><b>17</b> ソフトウェアの妥当性</a>
<ul>
<li class="chapter" data-level="17.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#研究コードの妥当性"><i class="fa fa-check"></i><b>17.1</b> 研究コードの妥当性</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#automation"><i class="fa fa-check"></i><b>17.1.1</b> 再現性のための自動化の必要性</a></li>
<li class="chapter" data-level="17.1.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#プログラミングのベストプラクティス"><i class="fa fa-check"></i><b>17.1.2</b> プログラミングのベストプラクティス</a></li>
<li class="chapter" data-level="17.1.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#コードの検証"><i class="fa fa-check"></i><b>17.1.3</b> コードの検証</a></li>
<li class="chapter" data-level="17.1.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-libraryの使用"><i class="fa fa-check"></i><b>17.1.4</b> Methods Libraryの使用</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-libraryのソフトウェア開発プロセス"><i class="fa fa-check"></i><b>17.2</b> Methods Libraryのソフトウェア開発プロセス</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#ソースコード管理"><i class="fa fa-check"></i><b>17.2.1</b> ソースコード管理</a></li>
<li class="chapter" data-level="17.2.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#ドキュメンテーション"><i class="fa fa-check"></i><b>17.2.2</b> ドキュメンテーション</a></li>
<li class="chapter" data-level="17.2.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#現行および過去のアーカイブバージョンの利用可能性"><i class="fa fa-check"></i><b>17.2.3</b> 現行および過去のアーカイブバージョンの利用可能性</a></li>
<li class="chapter" data-level="17.2.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#メンテナンスサポートおよびリタイアメント"><i class="fa fa-check"></i><b>17.2.4</b> メンテナンス、サポート、およびリタイアメント</a></li>
<li class="chapter" data-level="17.2.5" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#有資格者"><i class="fa fa-check"></i><b>17.2.5</b> 有資格者</a></li>
<li class="chapter" data-level="17.2.6" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#物理的および論理的セキュリティ"><i class="fa fa-check"></i><b>17.2.6</b> 物理的および論理的セキュリティ</a></li>
<li class="chapter" data-level="17.2.7" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#災害復旧"><i class="fa fa-check"></i><b>17.2.7</b> 災害復旧</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-libraryのテスト"><i class="fa fa-check"></i><b>17.3</b> Methods Libraryのテスト</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#単体テスト"><i class="fa fa-check"></i><b>17.3.1</b> 単体テスト</a></li>
<li class="chapter" data-level="17.3.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#シミュレーション"><i class="fa fa-check"></i><b>17.3.2</b> シミュレーション</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#まとめ-14"><i class="fa fa-check"></i><b>17.4</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="MethodValidity.html"><a href="MethodValidity.html"><i class="fa fa-check"></i><b>18</b> 方法の妥当性</a>
<ul>
<li class="chapter" data-level="18.1" data-path="MethodValidity.html"><a href="MethodValidity.html#デザイン特有の診断"><i class="fa fa-check"></i><b>18.1</b> デザイン特有の診断</a></li>
<li class="chapter" data-level="18.2" data-path="MethodValidity.html"><a href="MethodValidity.html#推定のための研究診断"><i class="fa fa-check"></i><b>18.2</b> 推定のための研究診断</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="MethodValidity.html"><a href="MethodValidity.html#NegativeControls"><i class="fa fa-check"></i><b>18.2.1</b> ネガティブコントロール</a></li>
<li class="chapter" data-level="18.2.2" data-path="MethodValidity.html"><a href="MethodValidity.html#PositiveControls"><i class="fa fa-check"></i><b>18.2.2</b> ポジティブコントロール</a></li>
<li class="chapter" data-level="18.2.3" data-path="MethodValidity.html"><a href="MethodValidity.html#metrics"><i class="fa fa-check"></i><b>18.2.3</b> 実証的評価</a></li>
<li class="chapter" data-level="18.2.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p値のキャリブレーション"><i class="fa fa-check"></i><b>18.2.4</b> P値のキャリブレーション</a></li>
<li class="chapter" data-level="18.2.5" data-path="MethodValidity.html"><a href="MethodValidity.html#信頼区間のキャリブレーション"><i class="fa fa-check"></i><b>18.2.5</b> 信頼区間のキャリブレーション</a></li>
<li class="chapter" data-level="18.2.6" data-path="MethodValidity.html"><a href="MethodValidity.html#医療機関をまたいだ複製"><i class="fa fa-check"></i><b>18.2.6</b> 医療機関をまたいだ複製</a></li>
<li class="chapter" data-level="18.2.7" data-path="MethodValidity.html"><a href="MethodValidity.html#感度分析"><i class="fa fa-check"></i><b>18.2.7</b> 感度分析</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="MethodValidity.html"><a href="MethodValidity.html#実践におけるメソッド検証"><i class="fa fa-check"></i><b>18.3</b> 実践におけるメソッド検証</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="MethodValidity.html"><a href="MethodValidity.html#ネガティブコントロールの選択"><i class="fa fa-check"></i><b>18.3.1</b> ネガティブコントロールの選択</a></li>
<li class="chapter" data-level="18.3.2" data-path="MethodValidity.html"><a href="MethodValidity.html#コントロールを含めること"><i class="fa fa-check"></i><b>18.3.2</b> コントロールを含めること</a></li>
<li class="chapter" data-level="18.3.3" data-path="MethodValidity.html"><a href="MethodValidity.html#実証されたパフォーマンス"><i class="fa fa-check"></i><b>18.3.3</b> 実証されたパフォーマンス</a></li>
<li class="chapter" data-level="18.3.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p値のキャリブレーション-1"><i class="fa fa-check"></i><b>18.3.4</b> P値のキャリブレーション</a></li>
<li class="chapter" data-level="18.3.5" data-path="MethodValidity.html"><a href="MethodValidity.html#信頼区間のキャリブレーション-1"><i class="fa fa-check"></i><b>18.3.5</b> 信頼区間のキャリブレーション</a></li>
<li class="chapter" data-level="18.3.6" data-path="MethodValidity.html"><a href="MethodValidity.html#データベース間の異質性"><i class="fa fa-check"></i><b>18.3.6</b> データベース間の異質性</a></li>
<li class="chapter" data-level="18.3.7" data-path="MethodValidity.html"><a href="MethodValidity.html#感度分析-1"><i class="fa fa-check"></i><b>18.3.7</b> 感度分析</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="MethodValidity.html"><a href="MethodValidity.html#ohdsi方法の評価ベンチマーク"><i class="fa fa-check"></i><b>18.4</b> OHDSI方法の評価ベンチマーク</a></li>
<li class="chapter" data-level="18.5" data-path="MethodValidity.html"><a href="MethodValidity.html#まとめ-15"><i class="fa fa-check"></i><b>18.5</b> まとめ</a></li>
</ul></li>
<li class="part"><span><b>V OHDSI研究</b></span></li>
<li class="chapter" data-level="19" data-path="StudySteps.html"><a href="StudySteps.html"><i class="fa fa-check"></i><b>19</b> 研究の段階</a>
<ul>
<li class="chapter" data-level="19.1" data-path="StudySteps.html"><a href="StudySteps.html#一般的なベストプラクティスガイドライン"><i class="fa fa-check"></i><b>19.1</b> 一般的なベストプラクティスガイドライン</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="StudySteps.html"><a href="StudySteps.html#観察研究の定義"><i class="fa fa-check"></i><b>19.1.1</b> 観察研究の定義</a></li>
<li class="chapter" data-level="19.1.2" data-path="StudySteps.html"><a href="StudySteps.html#事前に規定した研究デザイン"><i class="fa fa-check"></i><b>19.1.2</b> 事前に規定した研究デザイン</a></li>
<li class="chapter" data-level="19.1.3" data-path="StudySteps.html"><a href="StudySteps.html#プロトコル"><i class="fa fa-check"></i><b>19.1.3</b> プロトコル</a></li>
<li class="chapter" data-level="19.1.4" data-path="StudySteps.html"><a href="StudySteps.html#標準化された分析"><i class="fa fa-check"></i><b>19.1.4</b> 標準化された分析</a></li>
<li class="chapter" data-level="19.1.5" data-path="StudySteps.html"><a href="StudySteps.html#研究パッケージ"><i class="fa fa-check"></i><b>19.1.5</b> 研究パッケージ</a></li>
<li class="chapter" data-level="19.1.6" data-path="StudySteps.html"><a href="StudySteps.html#cdmに基づくデータ"><i class="fa fa-check"></i><b>19.1.6</b> CDMに基づくデータ</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="StudySteps.html"><a href="StudySteps.html#詳細な研究手順"><i class="fa fa-check"></i><b>19.2</b> 詳細な研究手順</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="StudySteps.html"><a href="StudySteps.html#問いを定義する"><i class="fa fa-check"></i><b>19.2.1</b> 問いを定義する</a></li>
<li class="chapter" data-level="19.2.2" data-path="StudySteps.html"><a href="StudySteps.html#データの可用性と質を確認する"><i class="fa fa-check"></i><b>19.2.2</b> データの可用性と質を確認する</a></li>
<li class="chapter" data-level="19.2.3" data-path="StudySteps.html"><a href="StudySteps.html#研究対象集団-1"><i class="fa fa-check"></i><b>19.2.3</b> 研究対象集団</a></li>
<li class="chapter" data-level="19.2.4" data-path="StudySteps.html"><a href="StudySteps.html#Feasibility"><i class="fa fa-check"></i><b>19.2.4</b> 実施可能性と研究診断</a></li>
<li class="chapter" data-level="19.2.5" data-path="StudySteps.html"><a href="StudySteps.html#プロトコルと研究パッケージの最終化"><i class="fa fa-check"></i><b>19.2.5</b> プロトコルと研究パッケージの最終化</a></li>
<li class="chapter" data-level="19.2.6" data-path="StudySteps.html"><a href="StudySteps.html#研究の実施"><i class="fa fa-check"></i><b>19.2.6</b> 研究の実施</a></li>
<li class="chapter" data-level="19.2.7" data-path="StudySteps.html"><a href="StudySteps.html#解釈と報告"><i class="fa fa-check"></i><b>19.2.7</b> 解釈と報告</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="StudySteps.html"><a href="StudySteps.html#まとめ-16"><i class="fa fa-check"></i><b>19.3</b> まとめ</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="NetworkResearch.html"><a href="NetworkResearch.html"><i class="fa fa-check"></i><b>20</b> OHDSI ネットワーク研究</a>
<ul>
<li class="chapter" data-level="20.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsi-研究ネットワークとして"><i class="fa fa-check"></i><b>20.1</b> OHDSI 研究ネットワークとして</a></li>
<li class="chapter" data-level="20.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究"><i class="fa fa-check"></i><b>20.2</b> OHDSIネットワーク研究</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究を実施する動機"><i class="fa fa-check"></i><b>20.2.1</b> OHDSIネットワーク研究を実施する動機</a></li>
<li class="chapter" data-level="20.2.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究の定義"><i class="fa fa-check"></i><b>20.2.2</b> OHDSIネットワーク研究の定義</a></li>
<li class="chapter" data-level="20.2.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究の設計上の考慮事項"><i class="fa fa-check"></i><b>20.2.3</b> OHDSIネットワーク研究の設計上の考慮事項</a></li>
<li class="chapter" data-level="20.2.4" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究のためのロジスティクスに関する考察"><i class="fa fa-check"></i><b>20.2.4</b> OHDSIネットワーク研究のためのロジスティクスに関する考察</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究の実行"><i class="fa fa-check"></i><b>20.3</b> OHDSIネットワーク研究の実行</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#研究デザインと実現可能性"><i class="fa fa-check"></i><b>20.3.1</b> 研究デザインと実現可能性</a></li>
<li class="chapter" data-level="20.3.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#研究の実行-1"><i class="fa fa-check"></i><b>20.3.2</b> 研究の実行</a></li>
<li class="chapter" data-level="20.3.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#結果の普及と公開"><i class="fa fa-check"></i><b>20.3.3</b> 結果の普及と公開</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="NetworkResearch.html"><a href="NetworkResearch.html#展望-ネットワーク研究の自動化を利用する"><i class="fa fa-check"></i><b>20.4</b> 展望: ネットワーク研究の自動化を利用する</a></li>
<li class="chapter" data-level="20.5" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsiネットワーク研究のベストプラクティス"><i class="fa fa-check"></i><b>20.5</b> OHDSIネットワーク研究のベストプラクティス</a></li>
<li class="chapter" data-level="20.6" data-path="NetworkResearch.html"><a href="NetworkResearch.html#まとめ-17"><i class="fa fa-check"></i><b>20.6</b> まとめ</a></li>
</ul></li>
<li class="appendix"><span><b>付録</b></span></li>
<li class="chapter" data-level="A" data-path="Glossary.html"><a href="Glossary.html"><i class="fa fa-check"></i><b>A</b> 用語集</a></li>
<li class="chapter" data-level="B" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html"><i class="fa fa-check"></i><b>B</b> コホート定義</a>
<ul>
<li class="chapter" data-level="B.1" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitors"><i class="fa fa-check"></i><b>B.1</b> ACE阻害薬</a></li>
<li class="chapter" data-level="B.2" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitorsMono"><i class="fa fa-check"></i><b>B.2</b> ACE阻害薬単剤療法新規ユーザー</a></li>
<li class="chapter" data-level="B.3" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Ami"><i class="fa fa-check"></i><b>B.3</b> 急性心筋梗塞</a></li>
<li class="chapter" data-level="B.4" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Angioedema"><i class="fa fa-check"></i><b>B.4</b> 血管性浮腫</a></li>
<li class="chapter" data-level="B.5" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ThiazidesMono"><i class="fa fa-check"></i><b>B.5</b> サイアザイド様利尿薬単剤療法の新規ユーザー使用者</a></li>
<li class="chapter" data-level="B.6" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN1yrFO"><i class="fa fa-check"></i><b>B.6</b> 高血圧のための第一選択治療を開始する患者</a></li>
<li class="chapter" data-level="B.7" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN3yrFO"><i class="fa fa-check"></i><b>B.7</b> 追跡期間が3年以上ある高血圧のための第一選択治療を開始する患者</a></li>
<li class="chapter" data-level="B.8" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ACEiUse"><i class="fa fa-check"></i><b>B.8</b> ACE阻害薬の使用</a></li>
<li class="chapter" data-level="B.9" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ARBUse"><i class="fa fa-check"></i><b>B.9</b> アンジオテンシン受容体拮抗薬（ARB）の使用</a></li>
<li class="chapter" data-level="B.10" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#THZUse"><i class="fa fa-check"></i><b>B.10</b> サイアザイドおよびサイアザイド様利尿薬の使用</a></li>
<li class="chapter" data-level="B.11" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#dCCBUse"><i class="fa fa-check"></i><b>B.11</b> ジヒドロピリジン系カルシウムチャネル遮断薬（DCCB）の使用</a></li>
<li class="chapter" data-level="B.12" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ndCCBUse"><i class="fa fa-check"></i><b>B.12</b> 非ジヒドロピリジン系カルシウムチャネル遮断薬（NDCCB）の使用</a></li>
<li class="chapter" data-level="B.13" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#BBUse"><i class="fa fa-check"></i><b>B.13</b> ベータ遮断薬使用</a></li>
<li class="chapter" data-level="B.14" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DLoopUse"><i class="fa fa-check"></i><b>B.14</b> ループ利尿薬使用</a></li>
<li class="chapter" data-level="B.15" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DPUse"><i class="fa fa-check"></i><b>B.15</b> カリウム保持性利尿薬使用</a></li>
<li class="chapter" data-level="B.16" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#A1BUse"><i class="fa fa-check"></i><b>B.16</b> アルファ-1遮断薬使用</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html"><i class="fa fa-check"></i><b>C</b> ネガティブコントロール</a>
<ul>
<li class="chapter" data-level="C.1" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html#AceiThzNsc"><i class="fa fa-check"></i><b>C.1</b> ACE阻害薬とサイアザイド・サイアザイド様利尿薬</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="ProtocolTemplate.html"><a href="ProtocolTemplate.html"><i class="fa fa-check"></i><b>D</b> プロトコルテンプレート</a></li>
<li class="chapter" data-level="E" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html"><i class="fa fa-check"></i><b>E</b> 解答例</a>
<ul>
<li class="chapter" data-level="E.1" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Cdmanswers"><i class="fa fa-check"></i><b>E.1</b> 共通データモデル</a></li>
<li class="chapter" data-level="E.2" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Vocabanswers"><i class="fa fa-check"></i><b>E.2</b> 標準化ボキャブラリ</a></li>
<li class="chapter" data-level="E.3" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Etlanswers"><i class="fa fa-check"></i><b>E.3</b> ETL （抽出-変換-読込）</a></li>
<li class="chapter" data-level="E.4" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#UseCasesanswers"><i class="fa fa-check"></i><b>E.4</b> データ分析の使用例</a></li>
<li class="chapter" data-level="E.5" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#SqlAndRanswers"><i class="fa fa-check"></i><b>E.5</b> SQLとR</a></li>
<li class="chapter" data-level="E.6" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Cohortsanswers"><i class="fa fa-check"></i><b>E.6</b> コホートの定義</a></li>
<li class="chapter" data-level="E.7" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Characterizationanswers"><i class="fa fa-check"></i><b>E.7</b> 特性評価</a></li>
<li class="chapter" data-level="E.8" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Pleanswers"><i class="fa fa-check"></i><b>E.8</b> 集団レベルの推定</a></li>
<li class="chapter" data-level="E.9" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Plpanswers"><i class="fa fa-check"></i><b>E.9</b> 患者レベルの予測</a></li>
<li class="chapter" data-level="E.10" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#DataQualityanswers"><i class="fa fa-check"></i><b>E.10</b> データ品質</a></li>
<li class="chapter" data-level="E.11" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#section"><i class="fa fa-check"></i><b>E.11</b> </a></li>
</ul></li>
<li class="chapter" data-level="" data-path="参考文献.html"><a href="参考文献.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OHDSIの本</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SqlAndR" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">第 9 章</span> SQLとR<a href="SqlAndR.html#SqlAndR" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>著者: Martijn Schuemie &amp; Peter Rijnbeek</em></p>
<p>共通データモデル（CDM）はリレーショナルデータベースモデルです（すべてのデータはフィールドを持つテーブルのレコードとして表されます）。そのため、データは通常、PostgreSQL、Oracle、Microsoft SQL Serverなどのソフトウェアプラットフォームを使用してリレーショナルデータベースに保存されます。ATLASやMethods LibraryなどのさまざまなOHDSIツールは、バックグラウンドでデータベースにクエリを出すことで動作しますが、適切なアクセス権があれば、私たちも自身も直接データベースにクエリを出すことができます。その主な理由は、現在のツールではサポートされていない分析を行うためです。ただし、OHDSI ツールは多くの場合、ユーザーがデータを適切に分析できるよう、ガイドするように設計されているため、データベースを直接クエリすると、間違いを犯すリスクも高くなります。直接のクエリでは、そのようなガイドは提供されていません。</p>
<p>リレーショナルデータベースをクエリする標準的な言語はSQL（Structured Query Language）で、クエリやデータ変更に使用できます。 SQLの基本コマンドは確かに標準化されており、ソフトウェアプラットフォーム間で同じ意味を持ちますが、各プラットフォームには独自の「方言」があり、微妙な違いがあります。 例えば、SQL Server上のPERSONテーブルの最初の10行を取得するには、次のように入力します： </p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="SqlAndR.html#cb8-1" tabindex="-1"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> <span class="op">*</span> <span class="kw">FROM</span> person;</span></code></pre></div>
<p>一方、PostgreSQLでは同じクエリは次のようになります：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="SqlAndR.html#cb9-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> person <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>OHDSIでは、プラットフォーム固有の表現に依存しないことを望んでいます。すなわち、すべてのOHDSIデータベースで同じSQL言語を使用したいと考えています。このため、OHDSIは<a href="https://ohdsi.github.io/SqlRender/">SqlRender</a>パッケージを開発しました。これは、ある標準の表現から後述するサポート対象の表現に翻訳できるRパッケージです。この標準表現である - <strong>OHDSI SQL</strong> - は主にSQL Server SQL表現のサブセットです。本章で例示するSQL文はすべてOHDSI SQLを使用します。 </p>
<p>各データベースプラットフォームには、SQLを使用したデータベースのクエリのための独自のソフトウェアツールも付属しています。OHDSIでは、多くのデータベースプラットフォームに接続できるRパッケージ、<a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a>パッケージを開発しました。DatabaseConnectorも本章の後半で説明します。 </p>
<p>そのため、CDMに準拠したデータベースに対してOHDSIツールを使用せずにクエリを実行できますが、推奨されるパスはDatabaseConnectorとSqlRenderパッケージを使用することです。これにより、あるサイトで開発されたクエリが他のサイトでも修正することなく使用できるようになります。R自体も、データベースから抽出されたデータをさらに分析する機能を提供しており、統計分析の実行や（インタラクティブな）プロットの生成などが可能です。 </p>
<p>本章では、読者がSQLの基本的な理解をしていることを前提としています。まず、SqlRenderとDatabaseConnectorの使用方法を確認します。これらのパッケージを使用しない場合は、このセクションをスキップいただいて構いません。セクション <a href="SqlAndR.html#QueryTheCdm">9.3</a> では、CDMにクエリを出すためのSQL（この場合OHDSI SQL）を使用する方法を説明します。次のセクションでは、CDMにクエリする際にOHDSI標準化ボキャブラリを使用する方法を説明します。CDMに対する一般的に使用されるクエリのコレクションであり、一般に公開されているQueryLibraryに焦点を当てます。本章の最後では、発生率を推定する研究例を取り上げ、SqlRenderとDatabaseConnectorを使用してこの研究を実施します。 </p>
<div id="SqlRender" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> SqlRender<a href="SqlAndR.html#SqlRender" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> パッケージは CRAN（Comprehensive R Archive Network）で入手可能であり、以下のコマンドでインストールできます：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="SqlAndR.html#cb10-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;SqlRender&quot;</span>)</span></code></pre></div>
<p>SqlRenderは、従来のデータベースシステム（PostgreSQL、Microsoft SQL Server、SQLite、Oracle）や並列データウェアハウス（Microsoft APS、IBM Netezza、Amazon Redshift）に加え、ビッグデータプラットフォーム（Hadoop から Impala、Google BigQuery）など、幅広い技術プラットフォームをサポートしています。Rパッケージには、パッケージマニュアルと、全機能を紹介するビネットが付属しています。ここでは、主な機能の一部を紹介します。</p>
<div id="sqlのパラメータ設定" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> SQLのパラメータ設定<a href="SqlAndR.html#sqlのパラメータ設定" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>パッケージの機能のひとつは、SQLのパラメータ化をサポートすることです。 しばしば、いくつかのパラメータに基づいて、SQLの小さなバリエーションを生成する必要があります。SqlRenderは、SQLコード内にシンプルなマークアップ構文を提供し、パラメータ化を可能にします。パラメータ値に基づくSQLのレンダリングは、<code>render()</code>関数を使用して行います。</p>
<div id="パラメータ値の置換" class="section level4 unnumbered hasAnchor">
<h4>パラメータ値の置換<a href="SqlAndR.html#パラメータ値の置換" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><code>@</code> 文字を使用して、レンダリング時に実際のパラメータ値と置換する必要があるパラメータ名を示します。以下の例では、SQL内で <code>a</code> という変数がSQLで言及されています。<code>render</code> 関数の呼び出しでは、このパラメータの値が定義されています：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="SqlAndR.html#cb11-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM concept WHERE concept_id = @a;&quot;</span></span>
<span id="cb11-2"><a href="SqlAndR.html#cb11-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">a =</span> <span class="dv">123</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id = 123;&quot;</code></pre>
<p>ほとんどのデータベース管理システムが提供するパラメータ化とは異なり、テーブル名やフィールド名を値と同様に簡単にパラメータ化できることに注目ください：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="SqlAndR.html#cb13-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM @x WHERE person_id = @a;&quot;</span></span>
<span id="cb13-2"><a href="SqlAndR.html#cb13-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="st">&quot;observation&quot;</span>, <span class="at">a =</span> <span class="dv">123</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM observation WHERE person_id = 123;&quot;</code></pre>
<p>パラメータ値は、数値、文字列、ブーリアン変数、ベクトル（カンマ区切りのリストに変換される）とすることができます：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="SqlAndR.html#cb15-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM concept WHERE concept_id IN (@a);&quot;</span></span>
<span id="cb15-2"><a href="SqlAndR.html#cb15-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">a =</span> <span class="fu">c</span>(<span class="dv">123</span>, <span class="dv">234</span>, <span class="dv">345</span>))</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id IN (123,234,345);&quot;</code></pre>
</div>
<div id="if-then-else" class="section level4 unnumbered hasAnchor">
<h4>If-Then-Else<a href="SqlAndR.html#if-then-else" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>時には、1つまたは複数のパラメータの値に基づいてコードブロックをオンまたはオフにする必要があります。これは、<code>{Condition} ? {if true} : {if false}</code> 構文を使用して行います。<em>条件</em> が true または 1 の場合、<em>if true</em> ブロックが使用され、それ以外の場合は <em>if false</em> ブロックが（存在する場合）表示されます。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="SqlAndR.html#cb17-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM cohort {@x} ? {WHERE subject_id = 1}&quot;</span></span>
<span id="cb17-2"><a href="SqlAndR.html#cb17-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort &quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="SqlAndR.html#cb19-1" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1&quot;</code></pre>
<p>簡単な比較もサポートされています：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="SqlAndR.html#cb21-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM cohort {@x == 1} ? {WHERE subject_id = 1};&quot;</span></span>
<span id="cb21-2"><a href="SqlAndR.html#cb21-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="SqlAndR.html#cb23-1" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort ;&quot;</code></pre>
<p><code>IN</code> 演算子もサポートされています：</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="SqlAndR.html#cb25-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM cohort {@x IN (1,2,3)} ? {WHERE subject_id = 1};&quot;</span></span>
<span id="cb25-2"><a href="SqlAndR.html#cb25-2" tabindex="-1"></a><span class="fu">render</span>(sql, <span class="at">x =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
</div>
</div>
<div id="他のsql表現への置換" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> 他のSQL表現への置換<a href="SqlAndR.html#他のsql表現への置換" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> パッケージのもう一つの機能は、OHDSI SQLから他のSQL表現へ変換することです。例えば：</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="SqlAndR.html#cb27-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT TOP 10 * FROM person;&quot;</span></span>
<span id="cb27-2"><a href="SqlAndR.html#cb27-2" tabindex="-1"></a><span class="fu">translate</span>(sql, <span class="at">targetDialect =</span> <span class="st">&quot;postgresql&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT  * FROM person LIMIT 10;&quot;
## attr(,&quot;sqlDialect&quot;)
## [1] &quot;postgresql&quot;</code></pre>
<p><code>targetDialect</code> パラメータには次の値が設定可能です：“oracle”, “postgresql”, “pdw”, “redshift”, “impala”, “netezza”, “bigquery”, “sqlite”, “sql server”。 </p>

<div class="rmdimportant">
SQL関数や構文を適切に変換できる範囲には限界があります。その理由は、パッケージには限られた数の変換ルールしか実装されていないことと、一部のSQL機能にはすべての方言に相当するものがないことが挙げられます。これが、OHDSI SQLが独自の新しいSQL方言として開発された主な理由です。しかし、可能な限り、車輪の再発明を避けるためにSQL Serverの構文に従うようにしています。
</div>
<p>最大限の努力を尽くしても、サポートされているすべてのプラットフォーム上でエラーなく実行されるOHDSI SQLを記載するには、考慮すべき点がいくつかあります。以下では、これらの考慮事項について詳しく説明します。</p>
<div id="translateがサポートする関数と構造" class="section level4 unnumbered hasAnchor">
<h4>Translateがサポートする関数と構造<a href="SqlAndR.html#translateがサポートする関数と構造" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>これらのSQL Server関数はテスト済であり、各表現への正確な変換が確認されています：</p>
<table>
<caption><span id="tab:sqlFunctions">表 9.1: </span> 「translate (翻訳)」によりサポートされる関数と構造</caption>
<thead>
<tr class="header">
<th align="left">関数</th>
<th align="left">関数</th>
<th align="left">関数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABS</td>
<td align="left">EXP</td>
<td align="left">RAND</td>
</tr>
<tr class="even">
<td align="left">ACOS</td>
<td align="left">FLOOR</td>
<td align="left">RANK</td>
</tr>
<tr class="odd">
<td align="left">ASIN</td>
<td align="left">GETDATE</td>
<td align="left">RIGHT</td>
</tr>
<tr class="even">
<td align="left">ATAN</td>
<td align="left">HASHBYTES*</td>
<td align="left">ROUND</td>
</tr>
<tr class="odd">
<td align="left">AVG</td>
<td align="left">ISNULL</td>
<td align="left">ROW_NUMBER</td>
</tr>
<tr class="even">
<td align="left">CAST</td>
<td align="left">ISNUMERIC</td>
<td align="left">RTRIM</td>
</tr>
<tr class="odd">
<td align="left">CEILING</td>
<td align="left">LEFT</td>
<td align="left">SIN</td>
</tr>
<tr class="even">
<td align="left">CHARINDEX</td>
<td align="left">LEN</td>
<td align="left">SQRT</td>
</tr>
<tr class="odd">
<td align="left">CONCAT</td>
<td align="left">LOG</td>
<td align="left">SQUARE</td>
</tr>
<tr class="even">
<td align="left">COS</td>
<td align="left">LOG10</td>
<td align="left">STDEV</td>
</tr>
<tr class="odd">
<td align="left">COUNT</td>
<td align="left">LOWER</td>
<td align="left">SUM</td>
</tr>
<tr class="even">
<td align="left">COUNT_BIG</td>
<td align="left">LTRIM</td>
<td align="left">TAN</td>
</tr>
<tr class="odd">
<td align="left">DATEADD</td>
<td align="left">MAX</td>
<td align="left">UPPER</td>
</tr>
<tr class="even">
<td align="left">DATEDIFF</td>
<td align="left">MIN</td>
<td align="left">VAR</td>
</tr>
<tr class="odd">
<td align="left">DATEFROMPARTS</td>
<td align="left">MONTH</td>
<td align="left">YEAR</td>
</tr>
<tr class="even">
<td align="left">DATETIMEFROMPARTS</td>
<td align="left">NEWID</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">DAY</td>
<td align="left">PI</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">EOMONTH</td>
<td align="left">POWER</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>* Oracleでは特別な権限が必要です。SQLiteでは同等のものがありません。</p>
<p>同様に、多くのSQL構文構造がサポートされています。以下は、正確に翻訳されることが確認されている非網羅的なリストです：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb29-1"><a href="SqlAndR.html#cb29-1" tabindex="-1"></a><span class="co">-- Simple selects:</span></span>
<span id="cb29-2"><a href="SqlAndR.html#cb29-2" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-3"><a href="SqlAndR.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="SqlAndR.html#cb29-4" tabindex="-1"></a><span class="co">-- Selects with joins:</span></span>
<span id="cb29-5"><a href="SqlAndR.html#cb29-5" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table_1 <span class="kw">INNER</span> <span class="kw">JOIN</span> table_2 <span class="kw">ON</span> a <span class="op">=</span> b;</span>
<span id="cb29-6"><a href="SqlAndR.html#cb29-6" tabindex="-1"></a></span>
<span id="cb29-7"><a href="SqlAndR.html#cb29-7" tabindex="-1"></a><span class="co">-- Nested queries:</span></span>
<span id="cb29-8"><a href="SqlAndR.html#cb29-8" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table_1) tmp <span class="kw">WHERE</span> a <span class="op">=</span> b;</span>
<span id="cb29-9"><a href="SqlAndR.html#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="SqlAndR.html#cb29-10" tabindex="-1"></a><span class="co">-- Limiting to top rows:</span></span>
<span id="cb29-11"><a href="SqlAndR.html#cb29-11" tabindex="-1"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-12"><a href="SqlAndR.html#cb29-12" tabindex="-1"></a></span>
<span id="cb29-13"><a href="SqlAndR.html#cb29-13" tabindex="-1"></a><span class="co">-- Selecting into a new table:</span></span>
<span id="cb29-14"><a href="SqlAndR.html#cb29-14" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> new_table <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-15"><a href="SqlAndR.html#cb29-15" tabindex="-1"></a></span>
<span id="cb29-16"><a href="SqlAndR.html#cb29-16" tabindex="-1"></a><span class="co">-- Creating tables:</span></span>
<span id="cb29-17"><a href="SqlAndR.html#cb29-17" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">table</span> (field <span class="dt">INT</span>);</span>
<span id="cb29-18"><a href="SqlAndR.html#cb29-18" tabindex="-1"></a></span>
<span id="cb29-19"><a href="SqlAndR.html#cb29-19" tabindex="-1"></a><span class="co">-- Inserting verbatim values:</span></span>
<span id="cb29-20"><a href="SqlAndR.html#cb29-20" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">VALUES</span> (<span class="dv">1</span>);</span>
<span id="cb29-21"><a href="SqlAndR.html#cb29-21" tabindex="-1"></a></span>
<span id="cb29-22"><a href="SqlAndR.html#cb29-22" tabindex="-1"></a><span class="co">-- Inserting from SELECT:</span></span>
<span id="cb29-23"><a href="SqlAndR.html#cb29-23" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">SELECT</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-24"><a href="SqlAndR.html#cb29-24" tabindex="-1"></a></span>
<span id="cb29-25"><a href="SqlAndR.html#cb29-25" tabindex="-1"></a><span class="co">-- Simple drop commands:</span></span>
<span id="cb29-26"><a href="SqlAndR.html#cb29-26" tabindex="-1"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="kw">table</span>;</span>
<span id="cb29-27"><a href="SqlAndR.html#cb29-27" tabindex="-1"></a></span>
<span id="cb29-28"><a href="SqlAndR.html#cb29-28" tabindex="-1"></a><span class="co">-- Drop table if it exists:</span></span>
<span id="cb29-29"><a href="SqlAndR.html#cb29-29" tabindex="-1"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;ACHILLES_analysis&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb29-30"><a href="SqlAndR.html#cb29-30" tabindex="-1"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> ACHILLES_analysis;</span>
<span id="cb29-31"><a href="SqlAndR.html#cb29-31" tabindex="-1"></a></span>
<span id="cb29-32"><a href="SqlAndR.html#cb29-32" tabindex="-1"></a><span class="co">-- Drop temp table if it exists:</span></span>
<span id="cb29-33"><a href="SqlAndR.html#cb29-33" tabindex="-1"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb..#cohorts&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb29-34"><a href="SqlAndR.html#cb29-34" tabindex="-1"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> #cohorts;</span>
<span id="cb29-35"><a href="SqlAndR.html#cb29-35" tabindex="-1"></a></span>
<span id="cb29-36"><a href="SqlAndR.html#cb29-36" tabindex="-1"></a><span class="co">-- Common table expressions:</span></span>
<span id="cb29-37"><a href="SqlAndR.html#cb29-37" tabindex="-1"></a><span class="kw">WITH</span> cte <span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>) <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> cte;</span>
<span id="cb29-38"><a href="SqlAndR.html#cb29-38" tabindex="-1"></a></span>
<span id="cb29-39"><a href="SqlAndR.html#cb29-39" tabindex="-1"></a><span class="co">-- OVER clauses:</span></span>
<span id="cb29-40"><a href="SqlAndR.html#cb29-40" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> a <span class="kw">ORDER</span> <span class="kw">BY</span> b)</span>
<span id="cb29-41"><a href="SqlAndR.html#cb29-41" tabindex="-1"></a>  <span class="kw">AS</span> <span class="ot">&quot;Row Number&quot;</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-42"><a href="SqlAndR.html#cb29-42" tabindex="-1"></a></span>
<span id="cb29-43"><a href="SqlAndR.html#cb29-43" tabindex="-1"></a><span class="co">-- CASE WHEN clauses:</span></span>
<span id="cb29-44"><a href="SqlAndR.html#cb29-44" tabindex="-1"></a><span class="kw">SELECT</span> <span class="cf">CASE</span> <span class="cf">WHEN</span> a<span class="op">=</span><span class="dv">1</span> <span class="cf">THEN</span> a <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> <span class="kw">AS</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb29-45"><a href="SqlAndR.html#cb29-45" tabindex="-1"></a></span>
<span id="cb29-46"><a href="SqlAndR.html#cb29-46" tabindex="-1"></a><span class="co">-- UNIONs:</span></span>
<span id="cb29-47"><a href="SqlAndR.html#cb29-47" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">UNION</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span>
<span id="cb29-48"><a href="SqlAndR.html#cb29-48" tabindex="-1"></a></span>
<span id="cb29-49"><a href="SqlAndR.html#cb29-49" tabindex="-1"></a><span class="co">-- INTERSECTIONs:</span></span>
<span id="cb29-50"><a href="SqlAndR.html#cb29-50" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">INTERSECT</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span>
<span id="cb29-51"><a href="SqlAndR.html#cb29-51" tabindex="-1"></a></span>
<span id="cb29-52"><a href="SqlAndR.html#cb29-52" tabindex="-1"></a><span class="co">-- EXCEPT:</span></span>
<span id="cb29-53"><a href="SqlAndR.html#cb29-53" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">EXCEPT</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span></code></pre></div>
</div>
<div id="文字列の連結" class="section level4 unnumbered hasAnchor">
<h4>文字列の連結<a href="SqlAndR.html#文字列の連結" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>文字列の連結は、SQL Serverが他の言語よりも特異的ではない領域の1つです。SQL Serverでは、<code>SELECT first_name + ' ' + last_name AS full_name FROM table</code> と書きますが、これは PostgreSQL と Oracle では <code>SELECT first_name || ' ' || last_name AS full_name FROM table</code> でなければなりません。SqlRenderは、連結される値が文字列であるかどうかを推測しようとします。上記の例では、明示的な文字列（シングルクォーテーションで囲まれたスペース）があるため、変換は正しく行われます。しかし、クエリが <code>SELECT first_name + last_name AS full_name FROM table</code> であった場合、SqlRenderは2つのフィールドが文字列であることを知る手がかりがなく、プラス記号を正しく残さないでしょう。値が文字列であることのもう一つの手がかりは、明示的なVARCHARへのキャストです。 そのため、<code>SELECT last_name + CAST(age AS VARCHAR(3)) AS full_name FROM table</code> も正しく翻訳されます。曖昧さを避けるために、2つ以上の文字列を連結する場合は、<code>CONCAT()</code> 関数を使用するのが最善の方法です。</p>
</div>
<div id="テーブルエイリアスとasキーワード" class="section level4 unnumbered hasAnchor">
<h4>テーブルエイリアスとASキーワード<a href="SqlAndR.html#テーブルエイリアスとasキーワード" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>多くのSQL表現ではテーブルエイリアスを定義する際に <code>AS</code> キーワードを使用できますが、キーワードなしでも問題なく動作します。例えば、以下のSQL文はSQL Server、PostgreSQL、Redshiftなどでは問題なく動作します：</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="SqlAndR.html#cb30-1" tabindex="-1"></a><span class="co">-- Using AS keyword</span></span>
<span id="cb30-2"><a href="SqlAndR.html#cb30-2" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb30-3"><a href="SqlAndR.html#cb30-3" tabindex="-1"></a><span class="kw">FROM</span> my_table <span class="kw">AS</span> table_1</span>
<span id="cb30-4"><a href="SqlAndR.html#cb30-4" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb30-5"><a href="SqlAndR.html#cb30-5" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> other_table</span>
<span id="cb30-6"><a href="SqlAndR.html#cb30-6" tabindex="-1"></a>) <span class="kw">AS</span> table_2</span>
<span id="cb30-7"><a href="SqlAndR.html#cb30-7" tabindex="-1"></a><span class="kw">ON</span> table_1.person_id <span class="op">=</span> table_2.person_id;</span>
<span id="cb30-8"><a href="SqlAndR.html#cb30-8" tabindex="-1"></a></span>
<span id="cb30-9"><a href="SqlAndR.html#cb30-9" tabindex="-1"></a><span class="co">-- Not using AS keyword</span></span>
<span id="cb30-10"><a href="SqlAndR.html#cb30-10" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb30-11"><a href="SqlAndR.html#cb30-11" tabindex="-1"></a><span class="kw">FROM</span> my_table table_1</span>
<span id="cb30-12"><a href="SqlAndR.html#cb30-12" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb30-13"><a href="SqlAndR.html#cb30-13" tabindex="-1"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> other_table</span>
<span id="cb30-14"><a href="SqlAndR.html#cb30-14" tabindex="-1"></a>) table_2</span>
<span id="cb30-15"><a href="SqlAndR.html#cb30-15" tabindex="-1"></a><span class="kw">ON</span> table_1.person_id <span class="op">=</span> table_2.person_id;</span></code></pre></div>
<p>しかし、Oracleでは <code>AS</code> キーワードを使用するとエラーが発生します。上記の例では、最初のクエリは失敗します。そのため、テーブルにエイリアスを付ける際には <code>AS</code> キーワードを使用しないことを推奨します。（注：SqlRenderではOracleが<code>AS</code> の使用を許可していないテーブルエイリアスとOracleが<code>AS</code>の使用を要求しているフィールドエイリアスを区別できないため、この問題に対応するのは難しいです。）</p>
</div>
<div id="テンポラリテーブルtemp-table" class="section level4 unnumbered hasAnchor">
<h4>テンポラリテーブル（Temp Table）<a href="SqlAndR.html#テンポラリテーブルtemp-table" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>テンポラリテーブルは中間結果を保存するのに非常に有用であり、正しく使用するとクエリのパフォーマンスを大幅に向上させることができます。ほとんどのデータベースプラットフォームでは、テンポラリテーブルには非常に優れた特性があります：現在のユーザーのみに参照でき、セッションが終了すると自動的に削除され、書き込みアクセス権がなくても作成できます。残念ながら、Oracleではテンポラリテーブルは基本的に恒久的なテーブルであり、唯一の違いはテーブル内のデータが現在のユーザーのみに参照されるという点です。このため、OracleではSqlRenderが以下の方法でテンポラリテーブルをエミュレートしようとします。</p>
<ol style="list-style-type: decimal">
<li>異なるユーザーからのテーブルが競合しないように、テーブル名にランダムな文字列を追加します。</li>
<li>テンポラリテーブルが作成されるスキーマをユーザーが指定できるようにします。</li>
</ol>
<p>例えば：</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="SqlAndR.html#cb31-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT * FROM #children;&quot;</span></span>
<span id="cb31-2"><a href="SqlAndR.html#cb31-2" tabindex="-1"></a><span class="fu">translate</span>(sql, <span class="at">targetDialect =</span> <span class="st">&quot;oracle&quot;</span>, <span class="at">oracleTempSchema =</span> <span class="st">&quot;temp_schema&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: The &#39;oracleTempSchema&#39; argument is deprecated. Use &#39;tempEmulationSchema&#39; instead.
## This warning is displayed once every 8 hours.</code></pre>
<pre><code>## [1] &quot;SELECT * FROM temp_schema.eq85wzhcchildren ;&quot;
## attr(,&quot;sqlDialect&quot;)
## [1] &quot;oracle&quot;</code></pre>
<p>ユーザーは <code>temp_schema</code> に書き込み権限を持っている必要があります。</p>
<p>また、Oracleではテーブル名の長さが30文字に制限されているため、<strong>テンポラリテーブル名は最大22文字以内である必要があります</strong>。セッションIDを追加すると名前が長くなりすぎるためです。</p>
<p>さらに、Oracleではテンポラリテーブルは自動的に削除されないため、使用後に明示的にすべてのテンポラリテーブルを <code>TRUNCATE</code> および <code>DROP</code> して、孤立したテーブルがOracleの一時スキーマに蓄積しないようにする必要があります。</p>
</div>
<div id="implicit-cast暗黙のデータ型変換" class="section level4 unnumbered hasAnchor">
<h4>Implicit Cast（暗黙のデータ型変換）<a href="SqlAndR.html#implicit-cast暗黙のデータ型変換" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>SQL Serverが他の言語よりも特異である数少ない点の1つは、暗黙の型変換が許可されていることです。例えば、次のコードはSQL Serverで動作します：</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="SqlAndR.html#cb34-1" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> #temp (txt <span class="dt">VARCHAR</span>);</span>
<span id="cb34-2"><a href="SqlAndR.html#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="SqlAndR.html#cb34-3" tabindex="-1"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #temp</span>
<span id="cb34-4"><a href="SqlAndR.html#cb34-4" tabindex="-1"></a><span class="kw">SELECT</span> <span class="st">&#39;1&#39;</span>;</span>
<span id="cb34-5"><a href="SqlAndR.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="SqlAndR.html#cb34-6" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
<p><code>txt</code> がVARCHARフィールドで、それを整数と比較しているとしても、SQL Serverは比較を可能にするために、2つのうちの1つを自動的に正しい型に変換します。これに対して、PostgreSQLなどの他の方言では、VARCHARとINTを比較しようとするとエラーが発生します。 したがって、castは常に明示的に行う必要があります。上記の例では、最後のステートメントを以下のいずれかに置き換える必要があります：</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="SqlAndR.html#cb35-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt <span class="op">=</span> <span class="fu">CAST</span>(<span class="dv">1</span> <span class="kw">AS</span> <span class="dt">VARCHAR</span>);</span></code></pre></div>
<p>または</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="SqlAndR.html#cb36-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> <span class="fu">CAST</span>(txt <span class="kw">AS</span> <span class="dt">INT</span>) <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
</div>
<div id="文字列比較における大文字小文字の区別" class="section level4 unnumbered hasAnchor">
<h4>文字列比較における大文字・小文字の区別<a href="SqlAndR.html#文字列比較における大文字小文字の区別" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>SQL Serverなどの一部のDBMSプラットフォームは常に大文字と小文字を区別せずに文字列比較を行いますが、PostgreSQLなどの他のプラットフォームは常に大文字と小文字を区別します。そのため、常に大文字・小文字を区別する比較を行うことを前提とし、大文字・小文字の区別が不明な場合は明示的に大文字・小文字の区別をしないようにすることを推奨します。例えば、次のように：</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="SqlAndR.html#cb37-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> concept <span class="kw">WHERE</span> concept_class_id <span class="op">=</span> <span class="st">&#39;Clinical Finding&#39;</span></span></code></pre></div>
<p>代わりに以下のように記述することが推奨されます：</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="SqlAndR.html#cb38-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> concept <span class="kw">WHERE</span> <span class="fu">LOWER</span>(concept_class_id) <span class="op">=</span> <span class="st">&#39;clinical finding&#39;</span></span></code></pre></div>
</div>
<div id="スキーマとデータベース" class="section level4 unnumbered hasAnchor">
<h4>スキーマとデータベース<a href="SqlAndR.html#スキーマとデータベース" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>SQL Serverでは、テーブルはスキーマ内にあり、スキーマはデータベース内にあります。例えば、<code>cdm_data.dbo.person</code> は <code>cdm_data</code> データベース内の <code>dbo</code> スキーマ内の <code>person</code> テーブルを指します。他の言語でも同様の階層が存在しますが、使用方法が大きく異なります。SQL Serverでは、データベースごとに通常1つのスキーマ（<code>dbo</code> と呼ばれることが多い）が存在し、ユーザーは異なるデータベース内のデータを簡単に使用できます。他のプラットフォーム、例えばPostgreSQLでは、単一セッションでデータベースをまたいだデータの使用はできませんが、データベース内に多くのスキーマが存在することがよくあります。PostgreSQLでは、SQL Serverのデータベースに相当するものがスキーマであると言えます。 そのため、SQL Serverのデータベースとスキーマを1つのパラメータに結合することを推奨します。通常、これを <code>@databaseSchema</code> と呼びます。例えば、パラメータ化されたSQLでは次のようになります：</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="SqlAndR.html#cb39-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> @databaseSchema.person</span></code></pre></div>
<p>SQL Serverでは、値にデータベース名とスキーマ名の両方を含めることができます：<code>databaseSchema = "cdm_data.dbo"</code>。他のプラットフォームでは、同じコードを使用し、パラメータ値としてスキーマのみを指定します：<code>databaseSchema = "cdm_data"</code>。</p>
<p>この方法が失敗する唯一の状況は <code>USE</code> コマンドを使用した場合です。なぜなら、USE cdm_data.dboを実行するとエラーが発生するからです。したがって、常にデータベース/スキーマを指定してテーブルの場所を示すようにし、<code>USE</code> コマンドの使用を避けることを推奨します。</p>
</div>
<div id="パラメータ化されたsqlのデバッグ" class="section level4 unnumbered hasAnchor">
<h4>パラメータ化されたSQLのデバッグ<a href="SqlAndR.html#パラメータ化されたsqlのデバッグ" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>パラメータ化されたSQLのデバッグは少し複雑になることがあります。レンダリングされたSQLのみがデータベースサーバーでテストできますが、コードの変更はパラメータ化された（レンダリング前の）SQLで行う必要があります。 </p>
<p>ソースのSQLをインタラクティブに編集し、レンダリングおよび翻訳されたSQLを生成するためのShinyアプリが SqlRender パッケージに含まれています。このアプリは次の方法で起動できます：</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="SqlAndR.html#cb40-1" tabindex="-1"></a><span class="fu">launchSqlRenderDeveloper</span>()</span></code></pre></div>
<p>これにより、図 <a href="SqlAndR.html#fig:sqlDeveloper">9.1</a> に示すように、アプリがデフォルトのブラウザで開きます。アプリはウェブ上でも公開されています<a href="#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a>。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:sqlDeveloper"></span>
<img src="images/SqlAndR/sqlDeveloper.png" alt="The SqlDeveloper Shiny app." width="100%" />
<p class="caption">
図 9.1: The SqlDeveloper Shiny app.
</p>
</div>
<p>このアプリでは、OHDSI SQLを入力し、ターゲットの方言を選択し、SQLに表示されるパラメータの値を入力すると、翻訳が自動的に下部に表示されます。</p>
</div>
</div>
</div>
<div id="DatabaseConnector" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> DatabaseConnector<a href="SqlAndR.html#DatabaseConnector" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a>は、JavaのJDBCドライバを使用してさまざまなデータベースプラットフォームに接続するためのRパッケージです。DatabaseConnectorパッケージはCRAN（Comprehensive R Archive Network）で入手可能で、次のようにインストールできます：</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="SqlAndR.html#cb41-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;DatabaseConnector&quot;</span>)</span></code></pre></div>
<p>DatabaseConnectorは、従来のデータベースシステム（PostgreSQL、Microsoft SQL Server、SQLite、およびOracle）、並列データウェアハウス（Microsoft APS、IBM Netezza、Amazon）、ならびにビッグデータプラットフォーム（Hadoopを介したImpala、およびGoogle BigQuery）など、広範な技術プラットフォームをサポートしています。このパッケージにはすでにほとんどのドライバが含まれていますが、ライセンス上の理由からBigQuery、Netezza、Impalaのドライバは含まれておらず、ユーザーが入手する必要があります。これらのドライバのダウンロード方法については、<code>?jdbcDrivers</code>を参照ください。ダウンロード後、<code>connect</code>、<code>dbConnect</code>、<code>createConnectionDetails</code>関数の<code>pathToDriver</code>引数を使用できます。</p>
<div id="接続の作成" class="section level3 hasAnchor" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> 接続の作成<a href="SqlAndR.html#接続の作成" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データベースに接続するには、データベースプラットフォーム、サーバーの位置、ユーザー名、パスワードなど、多くの詳細を指定する必要があります。<code>connect</code>関数を呼び出し、これらの詳細を直接指定することができます： </p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="SqlAndR.html#cb42-1" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">connect</span>(<span class="at">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb42-2"><a href="SqlAndR.html#cb42-2" tabindex="-1"></a>                <span class="at">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb42-3"><a href="SqlAndR.html#cb42-3" tabindex="-1"></a>                <span class="at">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb42-4"><a href="SqlAndR.html#cb42-4" tabindex="-1"></a>                <span class="at">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb42-5"><a href="SqlAndR.html#cb42-5" tabindex="-1"></a>                <span class="at">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>各プラットフォームに必要な詳細情報については、<code>?connect</code>を参照ください。接続を閉じたことを必ず確認ください：</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="SqlAndR.html#cb44-1" tabindex="-1"></a><span class="fu">disconnect</span>(conn)</span></code></pre></div>
<p>サーバー名を指定する代わりに、JDBC接続文字列を提供することも可能です。さらに便利な場合は、こちらを使用することもできます：</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="SqlAndR.html#cb45-1" tabindex="-1"></a>connString <span class="ot">&lt;-</span> <span class="st">&quot;jdbc:postgresql://localhost:5432/postgres&quot;</span></span>
<span id="cb45-2"><a href="SqlAndR.html#cb45-2" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">connect</span>(<span class="at">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb45-3"><a href="SqlAndR.html#cb45-3" tabindex="-1"></a>                <span class="at">connectionString =</span> connString,</span>
<span id="cb45-4"><a href="SqlAndR.html#cb45-4" tabindex="-1"></a>                <span class="at">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb45-5"><a href="SqlAndR.html#cb45-5" tabindex="-1"></a>                <span class="at">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb45-6"><a href="SqlAndR.html#cb45-6" tabindex="-1"></a>                <span class="at">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>場合によっては、接続の詳細を先に指定し、接続を後にしたい場合もあるでしょう。例えば、接続が関数内で確立される場合、詳細を引数として渡す必要がある場合に有用です。この目的には、<code>createConnectionDetails</code>関数を使用できます：</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="SqlAndR.html#cb47-1" tabindex="-1"></a>details <span class="ot">&lt;-</span> <span class="fu">createConnectionDetails</span>(<span class="at">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb47-2"><a href="SqlAndR.html#cb47-2" tabindex="-1"></a>                                   <span class="at">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb47-3"><a href="SqlAndR.html#cb47-3" tabindex="-1"></a>                                   <span class="at">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb47-4"><a href="SqlAndR.html#cb47-4" tabindex="-1"></a>                                   <span class="at">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb47-5"><a href="SqlAndR.html#cb47-5" tabindex="-1"></a>                                   <span class="at">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span>
<span id="cb47-6"><a href="SqlAndR.html#cb47-6" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">connect</span>(details)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
</div>
<div id="クエリの実行" class="section level3 hasAnchor" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> クエリの実行<a href="SqlAndR.html#クエリの実行" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データベースにクエリを実行するための主な関数は、<code>querySql</code>と<code>executeSql</code>です。<code>querySql</code>はデータがデータベースから返されることを想定しており、一度に1つのSQL文のみを処理できます。一方、<code>executeSql</code>はデータが返されることを想定せず、複数のSQL文を1つのSQL文字列で受け入れます。 </p>
<p>いくつかの例を挙げます：</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="SqlAndR.html#cb49-1" tabindex="-1"></a><span class="fu">querySql</span>(conn, <span class="st">&quot;SELECT TOP 3 * FROM person&quot;</span>)</span></code></pre></div>
<pre><code>##   person_id gender_concept_id year_of_birth
## 1         1              8507          1975
## 2         2              8507          1976
## 3         3              8507          1977</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="SqlAndR.html#cb51-1" tabindex="-1"></a><span class="fu">executeSql</span>(conn, <span class="st">&quot;TRUNCATE TABLE foo; DROP TABLE foo;&quot;</span>)</span></code></pre></div>
<p>どちらの関数も広範なエラーレポートを提供します：サーバーによってエラーが発生した場合、エラーメッセージと問題のあるSQL文がテキストファイルに書き込まれ、デバッグが容易になります。また、<code>executeSql</code>関数はデフォルトで進行状況バーを表示し、実行されたSQL文の割合を示します。それらの属性が不要な場合は、<code>lowLevelQuerySql</code>と<code>lowLevelExecuteSql</code>関数がパッケージに用意されています。</p>
</div>
<div id="ffdfオブジェクトを使用したクエリの実行" class="section level3 hasAnchor" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> ffdfオブジェクトを使用したクエリの実行<a href="SqlAndR.html#ffdfオブジェクトを使用したクエリの実行" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データベースから取得するデータがメモリに収まりきらないほど大きい場合もあります。セクション <a href="OhdsiAnalyticsTools.html#BigDataSupport">8.4.2</a> で述べたように、そのような場合には<code>ff</code>パッケージを使用してRデータオブジェクトをファイルに保存し、メモリ上にあるかのように使用することができます。<code>DatabaseConnector</code>はデータを直接ffdfオブジェクトにダウンロードすることができます：</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="SqlAndR.html#cb52-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">querySql.ffdf</span>(conn, <span class="st">&quot;SELECT * FROM person&quot;</span>)</span></code></pre></div>
<p>xは現在ffdfオブジェクトです。</p>
</div>
<div id="同じsqlを用いて異なるプラットフォームにクエリを実行する" class="section level3 hasAnchor" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> 同じSQLを用いて異なるプラットフォームにクエリを実行する<a href="SqlAndR.html#同じsqlを用いて異なるプラットフォームにクエリを実行する" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>SqlRenderパッケージの<code>render</code>と<code>translate</code>関数を最初に呼び出す便利な関数があります：<code>renderTranslateExecuteSql</code>、<code>renderTranslateQuerySql</code>、<code>renderTranslateQuerySql.ffdf</code>。例えば：</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="SqlAndR.html#cb53-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">renderTranslateQuerySql</span>(conn,</span>
<span id="cb53-2"><a href="SqlAndR.html#cb53-2" tabindex="-1"></a>                             <span class="at">sql =</span> <span class="st">&quot;SELECT TOP 10 * FROM @schema.person&quot;</span>,</span>
<span id="cb53-3"><a href="SqlAndR.html#cb53-3" tabindex="-1"></a>                             <span class="at">schema =</span> <span class="st">&quot;cdm_synpuf&quot;</span>)</span></code></pre></div>
<p>SQL Server固有の「TOP 10」構文は、PostgreSQLでは「LIMIT 10」などに変換され、SQLパラメーター<code>@schema</code>は提供された値「cdm_synpuf」に置き換えられます。</p>
</div>
<div id="テーブルの挿入" class="section level3 hasAnchor" number="9.2.5">
<h3><span class="header-section-number">9.2.5</span> テーブルの挿入<a href="SqlAndR.html#テーブルの挿入" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>データをデータベースに挿入するには<code>executeSql</code>関数を使用してSQLステートメントを送信することも可能ですが、最適化により<code>insertTable</code>関数を使用する方がより便利で高速です：</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="SqlAndR.html#cb54-1" tabindex="-1"></a><span class="fu">data</span>(mtcars)</span>
<span id="cb54-2"><a href="SqlAndR.html#cb54-2" tabindex="-1"></a><span class="fu">insertTable</span>(conn, <span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="at">createTable =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>この例では、mtcarsデータフレームをサーバー上の「mtcars」というテーブルにアップロードします。このテーブルは自動的に作成されます。</p>
</div>
</div>
<div id="QueryTheCdm" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> CDMへのクエリ<a href="SqlAndR.html#QueryTheCdm" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>以下の例では、OHDSI SQLを使用してCDMに準拠したデータベースにクエリを実行します。これらのクエリでは、CDMのデータベーススキーマを示すために<code>@cdm</code>を使用します。</p>
<p>まず、データベースに何人の人がいるかをクエリで取得してみましょう：</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="SqlAndR.html#cb55-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> person_count <span class="kw">FROM</span> @cdm.person;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">PERSON_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26299001</td>
</tr>
</tbody>
</table>
<p>あるいは、観察期間の平均的な長さに興味があるのかもしれません：</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="SqlAndR.html#cb56-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(DATEDIFF(<span class="dt">DAY</span>,</span>
<span id="cb56-2"><a href="SqlAndR.html#cb56-2" tabindex="-1"></a>                    observation_period_start_date,</span>
<span id="cb56-3"><a href="SqlAndR.html#cb56-3" tabindex="-1"></a>                    observation_period_end_date) <span class="op">/</span> <span class="fl">365.25</span>) <span class="kw">AS</span> num_years</span>
<span id="cb56-4"><a href="SqlAndR.html#cb56-4" tabindex="-1"></a><span class="kw">FROM</span> @cdm.observation_period;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">NUM_YEARS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.980803</td>
</tr>
</tbody>
</table>
<p>テーブルを結合して追加の統計を生成することができます。結合は通常、テーブル内の特定のフィールドに同じ値があることを要求することによって、複数のテーブルのフィールドを結合します。例えば、ここでは、両方のテーブルのPERSON_IDフィールドで、PERSONテーブルとOBSERVATION_PERIODテーブルを結合しています。つまり、結合の結果は、2つのテーブルのすべてのフィールドを持つ新しいテーブルのようなセットですが、すべての行において、2つのテーブルのPERSON_IDフィールドは同じ値でなければなりません。例えば、OBSERVATION_PERIODテーブルのOBSERVATION_PERIOD_END_DATEフィールドと、PERSONテーブルのyear_of_birthフィールドを組み合わせて使用することで、観察終了時の最大年齢を計算することができます：</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="SqlAndR.html#cb57-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="dt">YEAR</span>(observation_period_end_date) <span class="op">-</span></span>
<span id="cb57-2"><a href="SqlAndR.html#cb57-2" tabindex="-1"></a>           year_of_birth) <span class="kw">AS</span> max_age</span>
<span id="cb57-3"><a href="SqlAndR.html#cb57-3" tabindex="-1"></a><span class="kw">FROM</span> @cdm.person</span>
<span id="cb57-4"><a href="SqlAndR.html#cb57-4" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.observation_period</span>
<span id="cb57-5"><a href="SqlAndR.html#cb57-5" tabindex="-1"></a>  <span class="kw">ON</span> person.person_id <span class="op">=</span> observation_period.person_id;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">MAX_AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">90</td>
</tr>
</tbody>
</table>
<p>観察開始時の年齢分布を決定するには、はるかに複雑なクエリが必要です。このクエリでは、まずPERSONをOBSERVATION_PERIODテーブルに結合して観察開始時の年齢を計算します。また、この結合されたセットの順序を年齢に基づいて計算し、それをorder_nrとして保存します。この結合の結果を複数回使用したい場合には、共通テーブル式（common table expression; CTE）として定義し（<code>WITH ... AS</code>を使用）、「ages」と呼びます。これにより、agesを既存のテーブルであるかのように参照することができます。agesの行数を数えて「n」を生成し、各分位数に対して、order_nrが分数のn倍より小さい最小年齢を求めます。例えば、中央値を求めるには$<code>order_nr &lt; .50 * n</code>の最小年齢を使用します。最小年齢と最大年齢は別々に計算されます：</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb58-1"><a href="SqlAndR.html#cb58-1" tabindex="-1"></a><span class="kw">WITH</span> ages</span>
<span id="cb58-2"><a href="SqlAndR.html#cb58-2" tabindex="-1"></a><span class="kw">AS</span> (</span>
<span id="cb58-3"><a href="SqlAndR.html#cb58-3" tabindex="-1"></a>    <span class="kw">SELECT</span> age,</span>
<span id="cb58-4"><a href="SqlAndR.html#cb58-4" tabindex="-1"></a>        <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (</span>
<span id="cb58-5"><a href="SqlAndR.html#cb58-5" tabindex="-1"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> age</span>
<span id="cb58-6"><a href="SqlAndR.html#cb58-6" tabindex="-1"></a>            ) order_nr</span>
<span id="cb58-7"><a href="SqlAndR.html#cb58-7" tabindex="-1"></a>    <span class="kw">FROM</span> (</span>
<span id="cb58-8"><a href="SqlAndR.html#cb58-8" tabindex="-1"></a>        <span class="kw">SELECT</span> <span class="dt">YEAR</span>(observation_period_start_date) <span class="op">-</span> year_of_birth <span class="kw">AS</span> age</span>
<span id="cb58-9"><a href="SqlAndR.html#cb58-9" tabindex="-1"></a>        <span class="kw">FROM</span> @cdm.person</span>
<span id="cb58-10"><a href="SqlAndR.html#cb58-10" tabindex="-1"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.observation_period</span>
<span id="cb58-11"><a href="SqlAndR.html#cb58-11" tabindex="-1"></a>            <span class="kw">ON</span> person.person_id <span class="op">=</span> observation_period.person_id</span>
<span id="cb58-12"><a href="SqlAndR.html#cb58-12" tabindex="-1"></a>        ) age_computed</span>
<span id="cb58-13"><a href="SqlAndR.html#cb58-13" tabindex="-1"></a>    )</span>
<span id="cb58-14"><a href="SqlAndR.html#cb58-14" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MIN</span>(age) <span class="kw">AS</span> min_age,</span>
<span id="cb58-15"><a href="SqlAndR.html#cb58-15" tabindex="-1"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-16"><a href="SqlAndR.html#cb58-16" tabindex="-1"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> .<span class="dv">25</span> <span class="op">*</span> n</span>
<span id="cb58-17"><a href="SqlAndR.html#cb58-17" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-18"><a href="SqlAndR.html#cb58-18" tabindex="-1"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-19"><a href="SqlAndR.html#cb58-19" tabindex="-1"></a>            <span class="cf">END</span>) <span class="kw">AS</span> q25_age,</span>
<span id="cb58-20"><a href="SqlAndR.html#cb58-20" tabindex="-1"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-21"><a href="SqlAndR.html#cb58-21" tabindex="-1"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> .<span class="dv">50</span> <span class="op">*</span> n</span>
<span id="cb58-22"><a href="SqlAndR.html#cb58-22" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-23"><a href="SqlAndR.html#cb58-23" tabindex="-1"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-24"><a href="SqlAndR.html#cb58-24" tabindex="-1"></a>            <span class="cf">END</span>) <span class="kw">AS</span> median_age,</span>
<span id="cb58-25"><a href="SqlAndR.html#cb58-25" tabindex="-1"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-26"><a href="SqlAndR.html#cb58-26" tabindex="-1"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> .<span class="dv">75</span> <span class="op">*</span> n</span>
<span id="cb58-27"><a href="SqlAndR.html#cb58-27" tabindex="-1"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-28"><a href="SqlAndR.html#cb58-28" tabindex="-1"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-29"><a href="SqlAndR.html#cb58-29" tabindex="-1"></a>            <span class="cf">END</span>) <span class="kw">AS</span> q75_age,</span>
<span id="cb58-30"><a href="SqlAndR.html#cb58-30" tabindex="-1"></a>    <span class="fu">MAX</span>(age) <span class="kw">AS</span> max_age</span>
<span id="cb58-31"><a href="SqlAndR.html#cb58-31" tabindex="-1"></a><span class="kw">FROM</span> ages</span>
<span id="cb58-32"><a href="SqlAndR.html#cb58-32" tabindex="-1"></a><span class="kw">CROSS</span> <span class="kw">JOIN</span> (</span>
<span id="cb58-33"><a href="SqlAndR.html#cb58-33" tabindex="-1"></a>    <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> n</span>
<span id="cb58-34"><a href="SqlAndR.html#cb58-34" tabindex="-1"></a>    <span class="kw">FROM</span> ages</span>
<span id="cb58-35"><a href="SqlAndR.html#cb58-35" tabindex="-1"></a>    ) population_size;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">MIN_AGE</th>
<th align="right">Q25_AGE</th>
<th align="right">MEDIAN_AGE</th>
<th align="right">Q75_AGE</th>
<th align="right">MAX_AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">6</td>
<td align="right">17</td>
<td align="right">34</td>
<td align="right">90</td>
</tr>
</tbody>
</table>
<p>より複雑な計算は、SQLの代わりにRを使用して行うこともできます。例えば、同じ結果を得るため、次のRコードを使用することができます：</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="SqlAndR.html#cb59-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;SELECT YEAR(observation_period_start_date) -</span></span>
<span id="cb59-2"><a href="SqlAndR.html#cb59-2" tabindex="-1"></a><span class="st">               year_of_birth AS age</span></span>
<span id="cb59-3"><a href="SqlAndR.html#cb59-3" tabindex="-1"></a><span class="st">FROM @cdm.person</span></span>
<span id="cb59-4"><a href="SqlAndR.html#cb59-4" tabindex="-1"></a><span class="st">INNER JOIN @cdm.observation_period</span></span>
<span id="cb59-5"><a href="SqlAndR.html#cb59-5" tabindex="-1"></a><span class="st">  ON person.person_id = observation_period.person_id;&quot;</span></span>
<span id="cb59-6"><a href="SqlAndR.html#cb59-6" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">renderTranslateQuerySql</span>(conn, sql, <span class="at">cdm =</span> <span class="st">&quot;cdm&quot;</span>)</span>
<span id="cb59-7"><a href="SqlAndR.html#cb59-7" tabindex="-1"></a><span class="fu">quantile</span>(age[, <span class="dv">1</span>], <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   0%  25%  50%  75% 100%
##    0    6   17   34   90</code></pre>
<p>ここでは、サーバー上で年齢を計算し、すべての年齢をダウンロードし、年齢分布を計算します。しかし、これにはデータベースサーバーから数百万行ものデータをダウンロードする必要があり、効率的ではありません。計算をSQLで行うかRで行うかは、ケースバイケースで判断する必要があります。</p>
<p>クエリでは、CDM内のソース値を使用することができます。例えば、最も頻度の高いコンディションのソースコードのトップ10を取得するには、以下を用います：</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb61-1"><a href="SqlAndR.html#cb61-1" tabindex="-1"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> condition_source_value,</span>
<span id="cb61-2"><a href="SqlAndR.html#cb61-2" tabindex="-1"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> code_count</span>
<span id="cb61-3"><a href="SqlAndR.html#cb61-3" tabindex="-1"></a><span class="kw">FROM</span> @cdm.condition_occurrence</span>
<span id="cb61-4"><a href="SqlAndR.html#cb61-4" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> condition_source_value</span>
<span id="cb61-5"><a href="SqlAndR.html#cb61-5" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="op">-</span><span class="fu">COUNT</span>(<span class="op">*</span>);</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">CONDITION_SOURCE_VALUE</th>
<th align="right">CODE_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4019</td>
<td align="right">49094668</td>
</tr>
<tr class="even">
<td align="right">25000</td>
<td align="right">36149139</td>
</tr>
<tr class="odd">
<td align="right">78099</td>
<td align="right">28908399</td>
</tr>
<tr class="even">
<td align="right">319</td>
<td align="right">25798284</td>
</tr>
<tr class="odd">
<td align="right">31401</td>
<td align="right">22547122</td>
</tr>
<tr class="even">
<td align="right">317</td>
<td align="right">22453999</td>
</tr>
<tr class="odd">
<td align="right">311</td>
<td align="right">19626574</td>
</tr>
<tr class="even">
<td align="right">496</td>
<td align="right">19570098</td>
</tr>
<tr class="odd">
<td align="right">I10</td>
<td align="right">19453451</td>
</tr>
<tr class="even">
<td align="right">3180</td>
<td align="right">18973883</td>
</tr>
</tbody>
</table>
<p>ここでは、CONDITION_OCCURRENCEテーブル内のCONDITION_SOURCE_VALUEフィールドの値でレコードをグループ化し、各グループのレコード数をカウントしました。CONDITION_SOURCE_VALUEとそのカウントを取得し、カウントで逆順で並べ替えています。</p>
</div>
<div id="クエリ実行時にボキャブラリを使用する" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> クエリ実行時にボキャブラリを使用する<a href="SqlAndR.html#クエリ実行時にボキャブラリを使用する" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>多くの操作では、ボキャブラリが有用です。ボキャブラリテーブルはCDMの一部であり、SQLクエリを使用して利用できます。ここでは、ボキャブラリに対するクエリをCDMに対するクエリと組み合わせる方法を示します。CDMの多くのフィールドにはコンセプトIDが含まれていますが、これらはCONCEPTテーブルを使用して解決できます。例えば、データベース内の人数を性別で階層化してカウントしたい場合、GENDER_CONCEPT_IDフィールドをコンセプト名に解決すると便利です：</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb62-1"><a href="SqlAndR.html#cb62-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> subject_count,</span>
<span id="cb62-2"><a href="SqlAndR.html#cb62-2" tabindex="-1"></a>  concept_name</span>
<span id="cb62-3"><a href="SqlAndR.html#cb62-3" tabindex="-1"></a><span class="kw">FROM</span> @cdm.person</span>
<span id="cb62-4"><a href="SqlAndR.html#cb62-4" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept</span>
<span id="cb62-5"><a href="SqlAndR.html#cb62-5" tabindex="-1"></a>  <span class="kw">ON</span> person.gender_concept_id <span class="op">=</span> concept.concept_id</span>
<span id="cb62-6"><a href="SqlAndR.html#cb62-6" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> concept_name;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">SUBJECT_COUNT</th>
<th align="right">CONCEPT_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">14927548</td>
<td align="right">FEMALE</td>
</tr>
<tr class="even">
<td align="right">11371453</td>
<td align="right">MALE</td>
</tr>
</tbody>
</table>
<p>ボキャブラリの非常に強力な機能の一つは、その階層構造です。よくあるクエリは、特定のコンセプトと <em>そのすべての下位層</em>を探すものです。例えば、イププロフェンという成分を含む処方件数を数えるとします：</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb63-1"><a href="SqlAndR.html#cb63-1" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> prescription_count</span>
<span id="cb63-2"><a href="SqlAndR.html#cb63-2" tabindex="-1"></a><span class="kw">FROM</span> @cdm.drug_exposure</span>
<span id="cb63-3"><a href="SqlAndR.html#cb63-3" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept_ancestor</span>
<span id="cb63-4"><a href="SqlAndR.html#cb63-4" tabindex="-1"></a>  <span class="kw">ON</span> drug_concept_id <span class="op">=</span> descendant_concept_id</span>
<span id="cb63-5"><a href="SqlAndR.html#cb63-5" tabindex="-1"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept ingredient</span>
<span id="cb63-6"><a href="SqlAndR.html#cb63-6" tabindex="-1"></a>  <span class="kw">ON</span> ancestor_concept_id <span class="op">=</span> ingredient.concept_id</span>
<span id="cb63-7"><a href="SqlAndR.html#cb63-7" tabindex="-1"></a><span class="kw">WHERE</span> <span class="fu">LOWER</span>(ingredient.concept_name) <span class="op">=</span> <span class="st">&#39;ibuprofen&#39;</span></span>
<span id="cb63-8"><a href="SqlAndR.html#cb63-8" tabindex="-1"></a>  <span class="kw">AND</span> ingredient.concept_class_id <span class="op">=</span> <span class="st">&#39;Ingredient&#39;</span></span>
<span id="cb63-9"><a href="SqlAndR.html#cb63-9" tabindex="-1"></a>  <span class="kw">AND</span> ingredient.standard_concept <span class="op">=</span> <span class="st">&#39;S&#39;</span>;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">PRESCRIPTION_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26871214</td>
</tr>
</tbody>
</table>
</div>
<div id="querylibrary" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> QueryLibrary<a href="SqlAndR.html#querylibrary" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p></p>
<p>QueryLibraryは、CDM用の一般に使用されるSQLクエリのライブラリです。これはオンラインアプリケーション<a href="#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a>として提供されており、図 <a href="SqlAndR.html#fig:queryLibrary">9.2</a> に示すように、Rパッケージとしても利用できます<a href="#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a>。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:queryLibrary"></span>
<img src="images/SqlAndR/queryLibrary.png" alt="クエリライブラリ：CDMに対するSQLクエリのライブラリ" width="100%" />
<p class="caption">
図 9.2: クエリライブラリ：CDMに対するSQLクエリのライブラリ
</p>
</div>
<p>このライブラリの目的は、新しいユーザーがCDMのクエリ方法を学習するのを支援することです。ライブラリ内のクエリは、OHDSIコミュニティによって審査され、承認されています。クエリライブラリは主にトレーニング目的で使用されますが、経験豊富なユーザーにとっても貴重なリソースとなります。</p>
<p>QueryLibraryは、SqlRenderを利用して、選択したSQL方言でクエリを実行します。ユーザーはCDMのデータベーススキーマ、ボキャブラリデータベーススキーマ（別々のものがある場合）、Oracleテンポラリスキーマ（必要な場合）を指定することもでき、これらの設定でクエリが自動的にレンダリングされます。</p>
</div>
<div id="単純な研究デザイン" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> 単純な研究デザイン<a href="SqlAndR.html#単純な研究デザイン" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="問題の定義" class="section level3 hasAnchor" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> 問題の定義<a href="SqlAndR.html#問題の定義" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>血管性浮腫は、ACE阻害薬のよく知られた副作用です。<span class="citation">Slater et al. (<a href="#ref-slater_1988">1988</a>)</span> によると、ACE阻害薬治療開始後1週間の血管性浮腫の発症率は3,000人中1例/週と推定されています。ここでは、この結果を再現し、年齢と性別によって層別化します。単純化するため、ACE阻害薬の一つである（リシノプリル）に焦点を当てます。したがって、次の問いに答えます：</p>
<blockquote>
<p>リシノプリル投与開始後の最初の1週間での血管性浮腫の発生率は、年齢と性別で層別化するとどの程度でしょうか？</p>
</blockquote>
</div>
<div id="曝露" class="section level3 hasAnchor" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> 曝露<a href="SqlAndR.html#曝露" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>曝露をリシノプリルへの初回の曝露として定義します。初回とは、以前にリシノプリルへの曝露がないことを意味します。初回の曝露の前に365日間の連続した観察期間が必要となります。</p>
</div>
<div id="アウトカム" class="section level3 hasAnchor" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> アウトカム<a href="SqlAndR.html#アウトカム" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>血管性浮腫は、入院中または救急室ビジット中に血管性浮腫の診断コードが記録された場合と定義します。</p>
</div>
<div id="リスク期間" class="section level3 hasAnchor" number="9.6.4">
<h3><span class="header-section-number">9.6.4</span> リスク期間<a href="SqlAndR.html#リスク期間" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>治療開始後の最初の1週間の発生率を計算します。患者が1週間にわたって継続的に曝露されたかどうかは問いません。</p>
</div>
</div>
<div id="sqlとrを使用した研究の実施" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> SQLとRを使用した研究の実施<a href="SqlAndR.html#sqlとrを使用した研究の実施" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>OHDSIツールの慣例に縛られることはありませんが、同じ原則に従うことは有益です。この場合、OHDSIツールが動作するのと同様に、SQLを用いてコホートテーブルを作成します。COHORTテーブルはCDMに定義されており、使用する事前定義されたフィールドセットもあります。まず、書き込み権限のあるデータベーススキーマにCOHORTテーブルを作成する必要がありますが、これはCDM形式でデータを保持しているスキーマとは異なるスキーマである可能性が高いです。</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="SqlAndR.html#cb64-1" tabindex="-1"></a><span class="fu">library</span>(DatabaseConnector)</span>
<span id="cb64-2"><a href="SqlAndR.html#cb64-2" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">connect</span>(<span class="at">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb64-3"><a href="SqlAndR.html#cb64-3" tabindex="-1"></a>                <span class="at">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb64-4"><a href="SqlAndR.html#cb64-4" tabindex="-1"></a>                <span class="at">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb64-5"><a href="SqlAndR.html#cb64-5" tabindex="-1"></a>                <span class="at">password =</span> <span class="st">&quot;secret&quot;</span>)</span>
<span id="cb64-6"><a href="SqlAndR.html#cb64-6" tabindex="-1"></a>cdmDbSchema <span class="ot">&lt;-</span> <span class="st">&quot;cdm&quot;</span></span>
<span id="cb64-7"><a href="SqlAndR.html#cb64-7" tabindex="-1"></a>cohortDbSchema <span class="ot">&lt;-</span> <span class="st">&quot;scratch&quot;</span></span>
<span id="cb64-8"><a href="SqlAndR.html#cb64-8" tabindex="-1"></a>cohortTable <span class="ot">&lt;-</span> <span class="st">&quot;my_cohorts&quot;</span></span>
<span id="cb64-9"><a href="SqlAndR.html#cb64-9" tabindex="-1"></a></span>
<span id="cb64-10"><a href="SqlAndR.html#cb64-10" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb64-11"><a href="SqlAndR.html#cb64-11" tabindex="-1"></a><span class="st">CREATE TABLE @cohort_db_schema.@cohort_table (</span></span>
<span id="cb64-12"><a href="SqlAndR.html#cb64-12" tabindex="-1"></a><span class="st">  cohort_definition_id INT,</span></span>
<span id="cb64-13"><a href="SqlAndR.html#cb64-13" tabindex="-1"></a><span class="st">  cohort_start_date DATE,</span></span>
<span id="cb64-14"><a href="SqlAndR.html#cb64-14" tabindex="-1"></a><span class="st">  cohort_end_date DATE,</span></span>
<span id="cb64-15"><a href="SqlAndR.html#cb64-15" tabindex="-1"></a><span class="st">  subject_id BIGINT</span></span>
<span id="cb64-16"><a href="SqlAndR.html#cb64-16" tabindex="-1"></a><span class="st">);</span></span>
<span id="cb64-17"><a href="SqlAndR.html#cb64-17" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb64-18"><a href="SqlAndR.html#cb64-18" tabindex="-1"></a><span class="fu">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb64-19"><a href="SqlAndR.html#cb64-19" tabindex="-1"></a>                          <span class="at">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb64-20"><a href="SqlAndR.html#cb64-20" tabindex="-1"></a>                          <span class="at">cohort_table =</span> cohortTable)</span></code></pre></div>
<p>ここでは、データベーススキーマとテーブル名をパラメータ化しています。異なる環境に簡単に適応させることができます。その結果、データベースサーバー上に空のテーブルが作成されます。</p>
<div id="曝露コホート" class="section level3 hasAnchor" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> 曝露コホート<a href="SqlAndR.html#曝露コホート" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>次に、曝露コホートを作成し、COHORTテーブルに挿入します：</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="SqlAndR.html#cb65-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb65-2"><a href="SqlAndR.html#cb65-2" tabindex="-1"></a><span class="st">INSERT INTO @cohort_db_schema.@cohort_table (</span></span>
<span id="cb65-3"><a href="SqlAndR.html#cb65-3" tabindex="-1"></a><span class="st">  cohort_definition_id,</span></span>
<span id="cb65-4"><a href="SqlAndR.html#cb65-4" tabindex="-1"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb65-5"><a href="SqlAndR.html#cb65-5" tabindex="-1"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb65-6"><a href="SqlAndR.html#cb65-6" tabindex="-1"></a><span class="st">  subject_id</span></span>
<span id="cb65-7"><a href="SqlAndR.html#cb65-7" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb65-8"><a href="SqlAndR.html#cb65-8" tabindex="-1"></a><span class="st">SELECT 1 AS cohort_definition_id,</span></span>
<span id="cb65-9"><a href="SqlAndR.html#cb65-9" tabindex="-1"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb65-10"><a href="SqlAndR.html#cb65-10" tabindex="-1"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb65-11"><a href="SqlAndR.html#cb65-11" tabindex="-1"></a><span class="st">  subject_id</span></span>
<span id="cb65-12"><a href="SqlAndR.html#cb65-12" tabindex="-1"></a><span class="st">FROM (</span></span>
<span id="cb65-13"><a href="SqlAndR.html#cb65-13" tabindex="-1"></a><span class="st">  SELECT drug_era_start_date AS cohort_start_date,</span></span>
<span id="cb65-14"><a href="SqlAndR.html#cb65-14" tabindex="-1"></a><span class="st">    drug_era_end_date AS cohort_end_date,</span></span>
<span id="cb65-15"><a href="SqlAndR.html#cb65-15" tabindex="-1"></a><span class="st">    person_id AS subject_id</span></span>
<span id="cb65-16"><a href="SqlAndR.html#cb65-16" tabindex="-1"></a><span class="st">  FROM (</span></span>
<span id="cb65-17"><a href="SqlAndR.html#cb65-17" tabindex="-1"></a><span class="st">    SELECT drug_era_start_date,</span></span>
<span id="cb65-18"><a href="SqlAndR.html#cb65-18" tabindex="-1"></a><span class="st">      drug_era_end_date,</span></span>
<span id="cb65-19"><a href="SqlAndR.html#cb65-19" tabindex="-1"></a><span class="st">      person_id,</span></span>
<span id="cb65-20"><a href="SqlAndR.html#cb65-20" tabindex="-1"></a><span class="st">      ROW_NUMBER() OVER (</span></span>
<span id="cb65-21"><a href="SqlAndR.html#cb65-21" tabindex="-1"></a><span class="st">        PARTITION BY person_id</span></span>
<span id="cb65-22"><a href="SqlAndR.html#cb65-22" tabindex="-1"></a><span class="st">            ORDER BY drug_era_start_date</span></span>
<span id="cb65-23"><a href="SqlAndR.html#cb65-23" tabindex="-1"></a><span class="st">      ) order_nr</span></span>
<span id="cb65-24"><a href="SqlAndR.html#cb65-24" tabindex="-1"></a><span class="st">    FROM @cdm_db_schema.drug_era</span></span>
<span id="cb65-25"><a href="SqlAndR.html#cb65-25" tabindex="-1"></a><span class="st">    WHERE drug_concept_id = 1308216 -- リシノプリル</span></span>
<span id="cb65-26"><a href="SqlAndR.html#cb65-26" tabindex="-1"></a><span class="st">  ) ordered_exposures</span></span>
<span id="cb65-27"><a href="SqlAndR.html#cb65-27" tabindex="-1"></a><span class="st">  WHERE order_nr = 1</span></span>
<span id="cb65-28"><a href="SqlAndR.html#cb65-28" tabindex="-1"></a><span class="st">) first_era</span></span>
<span id="cb65-29"><a href="SqlAndR.html#cb65-29" tabindex="-1"></a><span class="st">INNER JOIN @cdm_db_schema.observation_period</span></span>
<span id="cb65-30"><a href="SqlAndR.html#cb65-30" tabindex="-1"></a><span class="st">  ON subject_id = person_id</span></span>
<span id="cb65-31"><a href="SqlAndR.html#cb65-31" tabindex="-1"></a><span class="st">    AND observation_period_start_date &lt; cohort_start_date</span></span>
<span id="cb65-32"><a href="SqlAndR.html#cb65-32" tabindex="-1"></a><span class="st">    AND observation_period_end_date &gt; cohort_start_date</span></span>
<span id="cb65-33"><a href="SqlAndR.html#cb65-33" tabindex="-1"></a><span class="st">WHERE DATEDIFF(DAY,</span></span>
<span id="cb65-34"><a href="SqlAndR.html#cb65-34" tabindex="-1"></a><span class="st">               observation_period_start_date,</span></span>
<span id="cb65-35"><a href="SqlAndR.html#cb65-35" tabindex="-1"></a><span class="st">               cohort_start_date) &gt;= 365;</span></span>
<span id="cb65-36"><a href="SqlAndR.html#cb65-36" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb65-37"><a href="SqlAndR.html#cb65-37" tabindex="-1"></a></span>
<span id="cb65-38"><a href="SqlAndR.html#cb65-38" tabindex="-1"></a><span class="fu">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb65-39"><a href="SqlAndR.html#cb65-39" tabindex="-1"></a>                          <span class="at">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb65-40"><a href="SqlAndR.html#cb65-40" tabindex="-1"></a>                          <span class="at">cohort_table =</span> cohortTable,</span>
<span id="cb65-41"><a href="SqlAndR.html#cb65-41" tabindex="-1"></a>                          <span class="at">cdm_db_schema =</span> cdmDbSchema)</span></code></pre></div>
<p>ここでは、CDMの標準テーブルであるDRUG_ERAテーブルを使用します。このテーブルはDRUG_EXPOSUREテーブルから自動的に派生するものです。DRUG_ERAテーブルには成分レベルでの継続的な曝露期間が含まれるため、リシノプリルを検索すると、自動的にリシノプリルを含む薬剤への曝露がすべて特定されます。次に、OBSERVATION_PERIOD テーブルに結合し、1人当たりの最初の薬物曝露を取り出します。1人の患者が複数の観察期間を持つ可能性があるため、薬物曝露を含む期間のみに結合する必要があります。また、OBSERVATION_PERIOD_START_DATE と COHORT_START_DATE の間には、少なくとも 365 日の間隔が必要となります。</p>
</div>
<div id="アウトカムコホート" class="section level3 hasAnchor" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> アウトカムコホート<a href="SqlAndR.html#アウトカムコホート" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>最後に、アウトカムコホートを作成する必要があります：</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="SqlAndR.html#cb66-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb66-2"><a href="SqlAndR.html#cb66-2" tabindex="-1"></a><span class="st">INSERT INTO @cohort_db_schema.@cohort_table (</span></span>
<span id="cb66-3"><a href="SqlAndR.html#cb66-3" tabindex="-1"></a><span class="st"> cohort_definition_id,</span></span>
<span id="cb66-4"><a href="SqlAndR.html#cb66-4" tabindex="-1"></a><span class="st"> cohort_start_date,</span></span>
<span id="cb66-5"><a href="SqlAndR.html#cb66-5" tabindex="-1"></a><span class="st"> cohort_end_date,</span></span>
<span id="cb66-6"><a href="SqlAndR.html#cb66-6" tabindex="-1"></a><span class="st">subject_id</span></span>
<span id="cb66-7"><a href="SqlAndR.html#cb66-7" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb66-8"><a href="SqlAndR.html#cb66-8" tabindex="-1"></a><span class="st">SELECT 2 AS cohort_definition_id,</span></span>
<span id="cb66-9"><a href="SqlAndR.html#cb66-9" tabindex="-1"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb66-10"><a href="SqlAndR.html#cb66-10" tabindex="-1"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb66-11"><a href="SqlAndR.html#cb66-11" tabindex="-1"></a><span class="st">  subject_id</span></span>
<span id="cb66-12"><a href="SqlAndR.html#cb66-12" tabindex="-1"></a><span class="st">FROM (</span></span>
<span id="cb66-13"><a href="SqlAndR.html#cb66-13" tabindex="-1"></a><span class="st">  SELECT DISTINCT person_id AS subject_id,</span></span>
<span id="cb66-14"><a href="SqlAndR.html#cb66-14" tabindex="-1"></a><span class="st">    condition_start_date AS cohort_start_date,</span></span>
<span id="cb66-15"><a href="SqlAndR.html#cb66-15" tabindex="-1"></a><span class="st">    condition_end_date AS cohort_end_date</span></span>
<span id="cb66-16"><a href="SqlAndR.html#cb66-16" tabindex="-1"></a><span class="st">  FROM @cdm_db_schema.condition_occurrence</span></span>
<span id="cb66-17"><a href="SqlAndR.html#cb66-17" tabindex="-1"></a><span class="st">  INNER JOIN @cdm_db_schema.concept_ancestor</span></span>
<span id="cb66-18"><a href="SqlAndR.html#cb66-18" tabindex="-1"></a><span class="st">    ON condition_concept_id = descendant_concept_id</span></span>
<span id="cb66-19"><a href="SqlAndR.html#cb66-19" tabindex="-1"></a><span class="st">  WHERE ancestor_concept_id = 432791 -- 血管性浮腫</span></span>
<span id="cb66-20"><a href="SqlAndR.html#cb66-20" tabindex="-1"></a><span class="st">) distinct_occurrence</span></span>
<span id="cb66-21"><a href="SqlAndR.html#cb66-21" tabindex="-1"></a><span class="st">INNER JOIN @cdm_db_schema.visit_occurrence</span></span>
<span id="cb66-22"><a href="SqlAndR.html#cb66-22" tabindex="-1"></a><span class="st">  ON subject_id = person_id</span></span>
<span id="cb66-23"><a href="SqlAndR.html#cb66-23" tabindex="-1"></a><span class="st">  AND visit_start_date &lt;= cohort_start_date</span></span>
<span id="cb66-24"><a href="SqlAndR.html#cb66-24" tabindex="-1"></a><span class="st">  AND visit_end_date &gt;= cohort_start_date</span></span>
<span id="cb66-25"><a href="SqlAndR.html#cb66-25" tabindex="-1"></a><span class="st">WHERE visit_concept_id IN (262, 9203,</span></span>
<span id="cb66-26"><a href="SqlAndR.html#cb66-26" tabindex="-1"></a><span class="st">    9201) -- 入院または救急室;</span></span>
<span id="cb66-27"><a href="SqlAndR.html#cb66-27" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb66-28"><a href="SqlAndR.html#cb66-28" tabindex="-1"></a></span>
<span id="cb66-29"><a href="SqlAndR.html#cb66-29" tabindex="-1"></a><span class="fu">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb66-30"><a href="SqlAndR.html#cb66-30" tabindex="-1"></a>                          <span class="at">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb66-31"><a href="SqlAndR.html#cb66-31" tabindex="-1"></a>                          <span class="at">cohort_table =</span> cohortTable,</span>
<span id="cb66-32"><a href="SqlAndR.html#cb66-32" tabindex="-1"></a>                          <span class="at">cdm_db_schema =</span> cdmDbSchema)</span></code></pre></div>
<p>ここでは、CONDITION_OCCURRENCEテーブルをCONCEPT_ANCESTORテーブルと結合して、血管性浮腫またはその下位層に含まれるすべての出現を見つけます。同じ日に複数の診断がある場合、それは同じ発生である可能性が高いため、各日1件のレコードのみを取得するようにDISTINCTを使用します。次に、診断が入院または救急室で行われたことを確認するために、これらの発生をVISIT_OCCURRENCEテーブルと結合します。</p>
</div>
<div id="発生率の計算" class="section level3 hasAnchor" number="9.7.3">
<h3><span class="header-section-number">9.7.3</span> 発生率の計算<a href="SqlAndR.html#発生率の計算" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>コホートが設定されたので、年齢と性別で層別化された発生率を計算できます：</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="SqlAndR.html#cb67-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb67-2"><a href="SqlAndR.html#cb67-2" tabindex="-1"></a><span class="st">WITH tar AS (</span></span>
<span id="cb67-3"><a href="SqlAndR.html#cb67-3" tabindex="-1"></a><span class="st">  SELECT concept_name AS gender,</span></span>
<span id="cb67-4"><a href="SqlAndR.html#cb67-4" tabindex="-1"></a><span class="st">    FLOOR((YEAR(cohort_start_date) -</span></span>
<span id="cb67-5"><a href="SqlAndR.html#cb67-5" tabindex="-1"></a><span class="st">          year_of_birth) / 10) AS age,</span></span>
<span id="cb67-6"><a href="SqlAndR.html#cb67-6" tabindex="-1"></a><span class="st">    subject_id,</span></span>
<span id="cb67-7"><a href="SqlAndR.html#cb67-7" tabindex="-1"></a><span class="st">    cohort_start_date,</span></span>
<span id="cb67-8"><a href="SqlAndR.html#cb67-8" tabindex="-1"></a><span class="st">    CASE WHEN DATEADD(DAY, 7, cohort_start_date) &gt;</span></span>
<span id="cb67-9"><a href="SqlAndR.html#cb67-9" tabindex="-1"></a><span class="st">      observation_period_end_date</span></span>
<span id="cb67-10"><a href="SqlAndR.html#cb67-10" tabindex="-1"></a><span class="st">    THEN observation_period_end_date</span></span>
<span id="cb67-11"><a href="SqlAndR.html#cb67-11" tabindex="-1"></a><span class="st">    ELSE DATEADD(DAY, 7, cohort_start_date)</span></span>
<span id="cb67-12"><a href="SqlAndR.html#cb67-12" tabindex="-1"></a><span class="st">    END AS cohort_end_date</span></span>
<span id="cb67-13"><a href="SqlAndR.html#cb67-13" tabindex="-1"></a><span class="st">  FROM @cohort_db_schema.@cohort_table</span></span>
<span id="cb67-14"><a href="SqlAndR.html#cb67-14" tabindex="-1"></a><span class="st">  INNER JOIN @cdm_db_schema.observation_period</span></span>
<span id="cb67-15"><a href="SqlAndR.html#cb67-15" tabindex="-1"></a><span class="st">    ON subject_id = observation_period.person_id</span></span>
<span id="cb67-16"><a href="SqlAndR.html#cb67-16" tabindex="-1"></a><span class="st">      AND observation_period_start_date &lt; cohort_start_date</span></span>
<span id="cb67-17"><a href="SqlAndR.html#cb67-17" tabindex="-1"></a><span class="st">      AND observation_period_end_date &gt; cohort_start_date</span></span>
<span id="cb67-18"><a href="SqlAndR.html#cb67-18" tabindex="-1"></a><span class="st">  INNER JOIN @cdm_db_schema.person</span></span>
<span id="cb67-19"><a href="SqlAndR.html#cb67-19" tabindex="-1"></a><span class="st">    ON subject_id = person.person_id</span></span>
<span id="cb67-20"><a href="SqlAndR.html#cb67-20" tabindex="-1"></a><span class="st">  INNER JOIN @cdm_db_schema.concept</span></span>
<span id="cb67-21"><a href="SqlAndR.html#cb67-21" tabindex="-1"></a><span class="st">    ON gender_concept_id = concept_id</span></span>
<span id="cb67-22"><a href="SqlAndR.html#cb67-22" tabindex="-1"></a><span class="st">  WHERE cohort_definition_id = 1 -- 曝露</span></span>
<span id="cb67-23"><a href="SqlAndR.html#cb67-23" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb67-24"><a href="SqlAndR.html#cb67-24" tabindex="-1"></a><span class="st">SELECT days.gender,</span></span>
<span id="cb67-25"><a href="SqlAndR.html#cb67-25" tabindex="-1"></a><span class="st">    days.age,</span></span>
<span id="cb67-26"><a href="SqlAndR.html#cb67-26" tabindex="-1"></a><span class="st">    days,</span></span>
<span id="cb67-27"><a href="SqlAndR.html#cb67-27" tabindex="-1"></a><span class="st">    CASE WHEN events IS NULL THEN 0 ELSE events END AS events</span></span>
<span id="cb67-28"><a href="SqlAndR.html#cb67-28" tabindex="-1"></a><span class="st">FROM (</span></span>
<span id="cb67-29"><a href="SqlAndR.html#cb67-29" tabindex="-1"></a><span class="st">  SELECT gender,</span></span>
<span id="cb67-30"><a href="SqlAndR.html#cb67-30" tabindex="-1"></a><span class="st">    age,</span></span>
<span id="cb67-31"><a href="SqlAndR.html#cb67-31" tabindex="-1"></a><span class="st">    SUM(DATEDIFF(DAY, cohort_start_date,</span></span>
<span id="cb67-32"><a href="SqlAndR.html#cb67-32" tabindex="-1"></a><span class="st">      cohort_end_date)) AS days</span></span>
<span id="cb67-33"><a href="SqlAndR.html#cb67-33" tabindex="-1"></a><span class="st">  FROM tar</span></span>
<span id="cb67-34"><a href="SqlAndR.html#cb67-34" tabindex="-1"></a><span class="st">  GROUP BY gender,</span></span>
<span id="cb67-35"><a href="SqlAndR.html#cb67-35" tabindex="-1"></a><span class="st">    age</span></span>
<span id="cb67-36"><a href="SqlAndR.html#cb67-36" tabindex="-1"></a><span class="st">) days</span></span>
<span id="cb67-37"><a href="SqlAndR.html#cb67-37" tabindex="-1"></a><span class="st">LEFT JOIN (</span></span>
<span id="cb67-38"><a href="SqlAndR.html#cb67-38" tabindex="-1"></a><span class="st">  SELECT gender,</span></span>
<span id="cb67-39"><a href="SqlAndR.html#cb67-39" tabindex="-1"></a><span class="st">      age,</span></span>
<span id="cb67-40"><a href="SqlAndR.html#cb67-40" tabindex="-1"></a><span class="st">      COUNT(*) AS events</span></span>
<span id="cb67-41"><a href="SqlAndR.html#cb67-41" tabindex="-1"></a><span class="st">  FROM tar</span></span>
<span id="cb67-42"><a href="SqlAndR.html#cb67-42" tabindex="-1"></a><span class="st">  INNER JOIN @cohort_db_schema.@cohort_table angioedema</span></span>
<span id="cb67-43"><a href="SqlAndR.html#cb67-43" tabindex="-1"></a><span class="st">    ON tar.subject_id = angioedema.subject_id</span></span>
<span id="cb67-44"><a href="SqlAndR.html#cb67-44" tabindex="-1"></a><span class="st">      AND tar.cohort_start_date &lt;= angioedema.cohort_start_date</span></span>
<span id="cb67-45"><a href="SqlAndR.html#cb67-45" tabindex="-1"></a><span class="st">      AND tar.cohort_end_date &gt;= angioedema.cohort_start_date</span></span>
<span id="cb67-46"><a href="SqlAndR.html#cb67-46" tabindex="-1"></a><span class="st">  WHERE cohort_definition_id = 2 -- アウトカム</span></span>
<span id="cb67-47"><a href="SqlAndR.html#cb67-47" tabindex="-1"></a><span class="st">  GROUP BY gender,</span></span>
<span id="cb67-48"><a href="SqlAndR.html#cb67-48" tabindex="-1"></a><span class="st">    age</span></span>
<span id="cb67-49"><a href="SqlAndR.html#cb67-49" tabindex="-1"></a><span class="st">) events</span></span>
<span id="cb67-50"><a href="SqlAndR.html#cb67-50" tabindex="-1"></a><span class="st">ON days.gender = events.gender</span></span>
<span id="cb67-51"><a href="SqlAndR.html#cb67-51" tabindex="-1"></a><span class="st">  AND days.age = events.age;</span></span>
<span id="cb67-52"><a href="SqlAndR.html#cb67-52" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb67-53"><a href="SqlAndR.html#cb67-53" tabindex="-1"></a></span>
<span id="cb67-54"><a href="SqlAndR.html#cb67-54" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">renderTranslateQuerySql</span>(conn, sql,</span>
<span id="cb67-55"><a href="SqlAndR.html#cb67-55" tabindex="-1"></a>                                   <span class="at">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb67-56"><a href="SqlAndR.html#cb67-56" tabindex="-1"></a>                                   <span class="at">cohort_table =</span> cohortTable,</span>
<span id="cb67-57"><a href="SqlAndR.html#cb67-57" tabindex="-1"></a>                                   <span class="at">cdm_db_schema =</span> cdmDbSchema,</span>
<span id="cb67-58"><a href="SqlAndR.html#cb67-58" tabindex="-1"></a>                                   <span class="at">snakeCaseToCamelCase =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>まず、CTE「tar」を作成し、適切なリスク時間を伴うすべての曝露を含めます。OBSERVATION_PERIOD_END_DATEでリスク時間が切り捨てられることに留意ください。また、10年ごとの年齢階層を計算し、性別を特定します。CTEを使用する利点は、クエリ中に同じ中間結果セットを複数回使用できることです。このユースケースでは、リスク時間の合計およびリスク時間中に発生する血管性浮腫のイベント数を数えるために使用します。</p>
<p>snakeCaseToCamelCase = TRUE を用いるのは、SQLではフィールド名にsnake_case を使用する傾向がある（SQLは大文字と小文字を区別しないため）のに対し、RではcamelCaseを使用する傾向がある（Rは大文字・小文字を区別するため）からです。<code>results</code>データフレームの列名はcamelCaseになります。</p>
<p>ggplot2パッケージを使用すると、結果を簡単にプロットできます：</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="SqlAndR.html#cb68-1" tabindex="-1"></a><span class="co"># 発生率（IR）を算出</span></span>
<span id="cb68-2"><a href="SqlAndR.html#cb68-2" tabindex="-1"></a>results<span class="sc">$</span>ir <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="sc">*</span> results<span class="sc">$</span>events <span class="sc">/</span> results<span class="sc">$</span>days <span class="sc">/</span> <span class="dv">7</span></span>
<span id="cb68-3"><a href="SqlAndR.html#cb68-3" tabindex="-1"></a></span>
<span id="cb68-4"><a href="SqlAndR.html#cb68-4" tabindex="-1"></a><span class="co"># 年齢スケールを修正</span></span>
<span id="cb68-5"><a href="SqlAndR.html#cb68-5" tabindex="-1"></a>results<span class="sc">$</span>age <span class="ot">&lt;-</span> results<span class="sc">$</span>age <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb68-6"><a href="SqlAndR.html#cb68-6" tabindex="-1"></a></span>
<span id="cb68-7"><a href="SqlAndR.html#cb68-7" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb68-8"><a href="SqlAndR.html#cb68-8" tabindex="-1"></a><span class="fu">ggplot</span>(results, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> ir, <span class="at">group =</span> gender, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb68-9"><a href="SqlAndR.html#cb68-9" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb68-10"><a href="SqlAndR.html#cb68-10" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;年齢&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="SqlAndR.html#cb68-11" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;発生率（1,000患者/週）&quot;</span>)</span></code></pre></div>
<p><img src="images/SqlAndR/ir.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="クリーンアップ" class="section level3 hasAnchor" number="9.7.4">
<h3><span class="header-section-number">9.7.4</span> クリーンアップ<a href="SqlAndR.html#クリーンアップ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>作成したテーブルをクリーンアップし、忘れずに接続を閉じます：</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="SqlAndR.html#cb69-1" tabindex="-1"></a>sql <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb69-2"><a href="SqlAndR.html#cb69-2" tabindex="-1"></a><span class="st">TRUNCATE TABLE @cohort_db_schema.@cohort_table;</span></span>
<span id="cb69-3"><a href="SqlAndR.html#cb69-3" tabindex="-1"></a><span class="st">DROP TABLE @cohort_db_schema.@cohort_table;</span></span>
<span id="cb69-4"><a href="SqlAndR.html#cb69-4" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb69-5"><a href="SqlAndR.html#cb69-5" tabindex="-1"></a><span class="fu">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb69-6"><a href="SqlAndR.html#cb69-6" tabindex="-1"></a>                          <span class="at">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb69-7"><a href="SqlAndR.html#cb69-7" tabindex="-1"></a>                          <span class="at">cohort_table =</span> cohortTable)</span>
<span id="cb69-8"><a href="SqlAndR.html#cb69-8" tabindex="-1"></a></span>
<span id="cb69-9"><a href="SqlAndR.html#cb69-9" tabindex="-1"></a><span class="fu">disconnect</span>(conn)</span></code></pre></div>
</div>
<div id="互換性" class="section level3 hasAnchor" number="9.7.5">
<h3><span class="header-section-number">9.7.5</span> 互換性<a href="SqlAndR.html#互換性" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>OHDSI SQLとDatabaseConnectorとSqlRenderを組み合わせて使用するため、ここで紹介したコードはOHDSIがサポートする任意のデータベースプラットフォームで実行できます。</p>
<p>デモンストレーション用に、手作業でSQLを使用してコホートを作成することにしましたが、ATLASでコホート定義を構築し、ATLASで生成されたSQLを使用してコホートをインスタンス化する方が便利です。ATLASもOHDSI SQLを生成するため、SqlRenderとDatabaseConnectorと簡単に併用することができます。</p>
</div>
</div>
<div id="まとめ-7" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> まとめ<a href="SqlAndR.html#まとめ-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div class="rmdsummary">
<ul>
<li><p><strong>SQL</strong>（Structured Query Language）は、共通データモデル（CDM）に準拠したデータベースを含む、データベースに照会するための標準言語です。</p></li>
<li><p>異なるデータベースプラットフォームは異なるSQL表現を持っており、照会するためには異なるツールが必要です。</p></li>
<li><p><strong>SqlRender</strong>と<strong>DatabaseConnector</strong> Rパッケージは、CDM内のデータを照会するための統一された方法を提供し、同じ分析コードを修正することなく異なる環境で実行できるようにします。</p></li>
<li><p>RとSQLを併用することで、OHDSIツールではサポートされていないカスタム分析を実装できます。</p></li>
<li><p><strong>QueryLibrary</strong>は、CDM用の再利用可能なSQLクエリのコレクションを提供します。</p></li>
</ul>
</div>
</div>
<div id="演習-4" class="section level2 hasAnchor" number="9.9">
<h2><span class="header-section-number">9.9</span> 演習<a href="SqlAndR.html#演習-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="前提条件-3" class="section level4 unnumbered hasAnchor">
<h4>前提条件<a href="SqlAndR.html#前提条件-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>これらの演習では、セクション <a href="OhdsiAnalyticsTools.html#installR">8.4.5</a> に記載されているように、R、R-Studio、Java がインストールされていることを前提とします。また、<a href="https://ohdsi.github.io/SqlRender/">SqlRender</a>、<a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a>、および <a href="https://ohdsi.github.io/Eunomia/">Eunomia</a> パッケージも必要です。以下の手順でインストールできます。</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="SqlAndR.html#cb70-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;SqlRender&quot;</span>, <span class="st">&quot;DatabaseConnector&quot;</span>, <span class="st">&quot;remotes&quot;</span>))</span>
<span id="cb70-2"><a href="SqlAndR.html#cb70-2" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;ohdsi/Eunomia&quot;</span>, <span class="at">ref =</span> <span class="st">&quot;v1.0.0&quot;</span>)</span></code></pre></div>
<p>Eunomia パッケージは、CDM 内でローカル R セッション内で動作する模擬データセットを提供します。接続の詳細は以下の方法で取得できます。</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="SqlAndR.html#cb71-1" tabindex="-1"></a>connectionDetails <span class="ot">&lt;-</span> Eunomia<span class="sc">::</span><span class="fu">getEunomiaConnectionDetails</span>()</span></code></pre></div>
<p>CDM データベースのスキーマは「main」です。</p>
<div class="exercise">
<p><span id="exr:exercisePeopleCount" class="exercise"><strong>演習 9.1  </strong></span>SQL と R を使用して、データベース内に何人いるかを計算します。</p>
</div>
<div class="exercise">
<p><span id="exr:exerciseCelecoxibUsers" class="exercise"><strong>演習 9.2  </strong></span>SQL と R を使用して、セレコキシブの処方を少なくとも１回受けたことがある人の人数を計算します。</p>
</div>
<div class="exercise">
<p><span id="exr:exerciseGiBleedsDuringCelecoxib" class="exercise"><strong>演習 9.3  </strong></span>SQL と R を使用して、セレコキシブの服用中に消化管出血と診断された人の人数を計算します。(ヒント: 消化管出血のコンセプト ID は <a href="http://athena.ohdsi.org/search-terms/terms/192671">192671</a> です)</p>
</div>
<p>解答例は付録 <a href="SuggestedAnswers.html#SqlAndRanswers">E.5</a> を参照ください。</p>

</div>
</div>
</div>
<h3>参考文献<a href="参考文献.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-slater_1988" class="csl-entry">
Slater, Eve E., Debora D. Merrill, Harry A. Guess, Peter J. Roylance, Warren D. Cooper, William H. W. Inman, and Pamela W. Ewan. 1988. <span>“<span class="nocase">Clinical Profile of Angioedema Associated With Angiotensin Converting-Enzyme Inhibition</span>.”</span> <em>JAMA</em> 260 (7): 967–70. <a href="https://doi.org/10.1001/jama.1988.03410070095035">https://doi.org/10.1001/jama.1988.03410070095035</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="51">
<li id="fn51"><p><a href="http://data.ohdsi.org/SqlDeveloper/" class="uri">http://data.ohdsi.org/SqlDeveloper/</a><a href="SqlAndR.html#fnref51" class="footnote-back">↩︎</a></p></li>
<li id="fn52"><p><a href="http://data.ohdsi.org/QueryLibrary" class="uri">http://data.ohdsi.org/QueryLibrary</a><a href="SqlAndR.html#fnref52" class="footnote-back">↩︎</a></p></li>
<li id="fn53"><p><a href="https://github.com/OHDSI/QueryLibrary" class="uri">https://github.com/OHDSI/QueryLibrary</a><a href="SqlAndR.html#fnref53" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="OhdsiAnalyticsTools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Cohorts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/OHDSI/TheBookOfOhdsiInJapanese/edit/main/SqlAndR.Rmd",
    "text": "エディション"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["TheBookOfOhdsi.pdf", "TheBookOfOhdsi.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
